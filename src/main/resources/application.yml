server:
  port: 8080

spring:
  application:
    name: nonce-demo
  
  # 数据源配置（PostgreSQL）
  datasource:
    driver-class-name: org.postgresql.Driver
    url: jdbc:postgresql://localhost:5432/nonce_db?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: postgres
    password: postgres
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  
  # Redis 配置
  data:
    redis:
      host: localhost
      port: 6379
      password: 
      database: 0
      timeout: 3000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms
  
  # MyBatis-Plus 配置
  mybatis-plus:
    configuration:
      map-underscore-to-camel-case: true
      log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    global-config:
      db-config:
        id-type: auto
        logic-delete-field: deleted
        logic-delete-value: 1
        logic-not-delete-value: 0

# MyBatis-Plus 配置
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  type-aliases-package: com.work.nonce.core.repository.entity

# Nonce 组件配置，可按需覆盖
nonce:
  redis-enabled: true
  lock-ttl: 10s
  reserved-timeout: 30s
  degrade-on-redis-failure: true
  # 分配策略：
  # - CACHE_RANGE：适用于 submitter 粘性路由/一致性哈希场景（默认，启用本地缓存+区间预分配）
  # - DB_ONLY：适用于 submitter 轮询到不同节点场景（禁用本地缓存收益，强制 batchSize=1）
  allocation-strategy: CACHE_RANGE
  # 混合场景覆盖：这些 submitter 强制走 DB_ONLY（即使全局策略是 CACHE_RANGE）
  # 例：
  # db-only-submitters:
  #   - "0xabc..."
  #   - "0xdef..."
  db-only-submitters: []
  cache-enabled: true
  cache-size: 1000
  cache-timeout: 1h
  pre-allocate-size: 50
  chain-query-enabled: true
  chain-query-max-retries: 3
  recycle-throttle: 5s
  # PENDING（隔离态）最大持续时间：超过后由对账任务“定案”（ACCEPTED 或 RECYCLABLE）
  pending-max-age: 5m
  # PENDING（隔离态）硬上限：超过后不再自动回收/定案，只保留并告警，走人工处理
  pending-hard-max-age: 2h
  # 是否启用定时对账任务（处理超时 RESERVED -> PENDING，以及 PENDING 定案）
  reconcile-enabled: true
  # 每次对账任务最大处理条数
  reconcile-batch-size: 200
  # 对账任务执行间隔（毫秒）
  reconcile-interval-ms: 5000
  # 是否启用历史数据清理（建议生产用分区/归档；demo 提供可选批量删除）
  cleanup-enabled: false
  # 热窗口保留天数（建议 7~14 天）
  hot-retention-days: 14
  # 清理任务执行间隔（毫秒）
  cleanup-interval-ms: 3600000
  # 单次清理最大删除条数
  cleanup-batch-size: 5000
  shared-account: false
