<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'><style type='text/css'>html {overflow-x: initial !important;}</style>
<style type='text/css'  id="style-mermaid">:root { --mermaid-theme: default; --mermaid-sequence-numbers: off; --mermaid-flowchart-curve: linear; --mermaid--gantt-left-padding: 75; --sequence-theme: simple; }
.privacy { display: none; }

</style>
<style type='text/css'  id="style-base">:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, "Segoe UI Emoji", "SF Pro", sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.428571; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p *, #write.first-line-indent svg * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-width: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-variant-alternates: inherit; font-variant-ligatures: inherit; font-variant-numeric: inherit; font-variant-east-asian: inherit; font-variant-position: inherit; font-variant-emoji: inherit; font-feature-settings: inherit; font-optical-sizing: inherit; font-variation-settings: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; position: relative; }
#write svg h1, #write svg h2, #write svg h3, #write svg h4, #write svg h5, #write svg h6, #write svg p { position: static; }
.nodeLabel p { padding-right: 2px; padding-left: 2px; }
.typora-export .nodeLabel p { padding-right: 0px; padding-left: 0px; }
foreignObject { overflow: visible; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
li p { orphans: 1; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; border-right-style: none; border-right-color: currentcolor; background-color: inherit; }
.CodeMirror-linenumber { -webkit-user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: medium; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: medium !important; border-style: none !important; border-color: currentcolor !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; border-bottom-style: none; border-bottom-color: currentcolor; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: medium; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.mermaid-svg { margin: auto; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left-width: 0.25em; border-left-style: solid; border-left-color: rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }

</style>
<style type='text/css'  id="style-codemirror">.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: medium !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}

</style>
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&amp;subset=latin,latin-ext' type='text/css' />
<style type='text/css'  id="style-theme_css">:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', 'SF Pro', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    pre {
        page-break-inside: avoid;
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.mac-os #write{
    caret-color: AccentColor;
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}
</style>
<style type='text/css'  id="style-lp">ol, ul {padding-left: 40px}</style>
<style type='text/css'  id="style-mac-print"> @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}</style>

<title>nonce management sequence diagram v2</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='nonce-management-sequence-diagram-v2'><span>Nonce management sequence diagram v2</span></h1><h2 id='方案优缺点'><span>方案优缺点</span></h2><h4 id='优势高吞吐低延迟支持可靠性能双模式切换具备自动降级与监控闭环保障高可用并通过异步刷盘保证最终一致性'><strong><span>优势：</span></strong><span>高吞吐低延迟，支持可靠/性能双模式切换，具备自动降级与监控闭环保障高可用，并通过异步刷盘保证最终一致性</span></h4><h4 id='限制存在redis与db短暂不一致窗口依赖redis队列后台线程导致故障点和运维复杂度上升分布式锁与刷盘队列在极端高并发下仍可能成为瓶颈需要投入精力保障高可用'><strong><span>限制</span></strong><span>：存在Redis与DB短暂不一致窗口，依赖Redis+队列+后台线程导致故障点和运维复杂度上升，分布式锁与刷盘队列在极端高并发下仍可能成为瓶颈，需要投入精力保障高可用。</span></h4><h2 id='系统全景图'><span>系统全景图</span></h2><div class="md-diagram-panel md-fences-adv-panel" lang="mermaid"><svg id="mermaidChart186" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart mermaid-svg" style="max-width: 1030.8671875px;" viewBox="0 0 1030.8671875 1714.0670166015625" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaidChart186{font-family:sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaidChart186 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaidChart186 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaidChart186 .error-icon{fill:#552222;}#mermaidChart186 .error-text{fill:#552222;stroke:#552222;}#mermaidChart186 .edge-thickness-normal{stroke-width:1px;}#mermaidChart186 .edge-thickness-thick{stroke-width:3.5px;}#mermaidChart186 .edge-pattern-solid{stroke-dasharray:0;}#mermaidChart186 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaidChart186 .edge-pattern-dashed{stroke-dasharray:3;}#mermaidChart186 .edge-pattern-dotted{stroke-dasharray:2;}#mermaidChart186 .marker{fill:#333333;stroke:#333333;}#mermaidChart186 .marker.cross{stroke:#333333;}#mermaidChart186 svg{font-family:sans-serif;font-size:16px;}#mermaidChart186 p{margin:0;}#mermaidChart186 .label{font-family:sans-serif;color:#333;}#mermaidChart186 .cluster-label text{fill:#333;}#mermaidChart186 .cluster-label span{color:#333;}#mermaidChart186 .cluster-label span p{background-color:transparent;}#mermaidChart186 .label text,#mermaidChart186 span{fill:#333;color:#333;}#mermaidChart186 .node rect,#mermaidChart186 .node circle,#mermaidChart186 .node ellipse,#mermaidChart186 .node polygon,#mermaidChart186 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaidChart186 .rough-node .label text,#mermaidChart186 .node .label text,#mermaidChart186 .image-shape .label,#mermaidChart186 .icon-shape .label{text-anchor:middle;}#mermaidChart186 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaidChart186 .rough-node .label,#mermaidChart186 .node .label,#mermaidChart186 .image-shape .label,#mermaidChart186 .icon-shape .label{text-align:center;}#mermaidChart186 .node.clickable{cursor:pointer;}#mermaidChart186 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaidChart186 .arrowheadPath{fill:#333333;}#mermaidChart186 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaidChart186 .flowchart-link{stroke:#333333;fill:none;}#mermaidChart186 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaidChart186 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaidChart186 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaidChart186 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaidChart186 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaidChart186 .cluster text{fill:#333;}#mermaidChart186 .cluster span{color:#333;}#mermaidChart186 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaidChart186 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaidChart186 rect.text{fill:none;stroke-width:0;}#mermaidChart186 .icon-shape,#mermaidChart186 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaidChart186 .icon-shape p,#mermaidChart186 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaidChart186 .icon-shape rect,#mermaidChart186 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaidChart186 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaidChart186 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaidChart186 :root{--mermaid-alt-font-family:sans-serif;}</style><g><marker id="mermaidChart186_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart186_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart186_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaidChart186_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaidChart186_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart186_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"><g class="cluster " id="后台服务" data-look="classic"><rect style="" x="8" y="1405.6240158081055" width="440" height="128"></rect><g class="cluster-label " transform="translate(194, 1405.6240158081055)"><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>后台服务</p></span></div></foreignObject></g></g><g class="cluster " id="存储层" data-look="classic"><rect style="" x="468" y="1202" width="451.8671875" height="504.06702423095703"></rect><g class="cluster-label " transform="translate(667.93359375, 1202)"><foreignObject width="52" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>存储层</p></span></div></foreignObject></g></g><g class="cluster " id="分配引擎层" data-look="classic"><rect style="" x="501.21875" y="1024" width="521.6484375" height="128"></rect><g class="cluster-label " transform="translate(720.04296875, 1024)"><foreignObject width="84" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>分配引擎层</p></span></div></foreignObject></g></g><g class="cluster " id="引擎管理层" data-look="classic"><rect style="" x="592.16796875" y="822" width="371.19921875" height="128"></rect><g class="cluster-label " transform="translate(735.767578125, 822)"><foreignObject width="84" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>引擎管理层</p></span></div></foreignObject></g></g><g class="cluster " id="执行层" data-look="classic"><rect style="" x="601.71875" y="516" width="302.8515625" height="256"></rect><g class="cluster-label " transform="translate(727.14453125, 516)"><foreignObject width="52" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>执行层</p></span></div></foreignObject></g></g><g class="cluster " id="接口层" data-look="classic"><rect style="" x="668.97265625" y="210" width="215.84375" height="256"></rect><g class="cluster-label " transform="translate(750.89453125, 210)"><foreignObject width="52" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>接口层</p></span></div></foreignObject></g></g><g class="cluster " id="业务层" data-look="classic"><rect style="" x="661.89453125" y="8" width="230" height="128"></rect><g class="cluster-label " transform="translate(750.89453125, 8)"><foreignObject width="52" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>业务层</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path d="M776.895,111L776.895,136L776.895,173L776.895,210L776.895,231" id="L_Business_API_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M776.895,313L776.895,338L776.895,359" id="L_API_Facade_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M776.895,441L776.895,466L776.895,491L776.895,516L776.895,537" id="L_Facade_Template_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M811.934,619L834.395,644L834.395,708L834.395,772L834.395,797L834.395,822L814.607,844.025" id="L_Template_Manager_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M848.895,923.472L899.867,950L899.867,987L899.867,1024L899.867,1045" id="L_Manager_Reliable_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M709.116,925L665.668,950L665.668,987L665.668,1024L665.668,1045" id="L_Manager_Performance_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M899.867,1127L899.867,1152L899.867,1177L899.867,1202L899.867,1279.312L899.867,1368.624L899.867,1405.624L899.867,1469.624L899.867,1533.624L899.867,1558.624L879.201,1585.829" id="L_Reliable_DB_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M614.04,1127L580.945,1152L580.945,1177L580.945,1202L580.945,1223" id="L_Performance_Redis_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M717.296,1127L750.391,1152L750.391,1177L750.391,1202L750.391,1228.852" id="L_Performance_Queue_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M750.391,1325.773L750.391,1368.624L750.391,1405.624L416.954,1456.751" id="L_Queue_Worker_0" class=" edge-thickness-normal edge-pattern-dotted edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M333,1508.624L333,1533.624L657.445,1558.624L775.027,1608.344" id="L_Worker_DB_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M741.855,619L719.395,644L719.395,665" id="L_Template_Processor_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M719.395,747L719.395,772L719.395,797L719.395,822L739.182,844.025" id="L_Processor_Manager_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path><path d="M123,1508.624L123,1533.624L613.406,1558.624L774.921,1613.148" id="L_Cleanup_DB_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart186_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(776.89453125, 173)"><g class="label" transform="translate(-32, -12)"><foreignObject width="64" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>业务请求</p></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(899.8671875, 987)"><g class="label" transform="translate(-32, -12)"><foreignObject width="64" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>可靠模式</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(665.66796875, 987)"><g class="label" transform="translate(-32, -12)"><foreignObject width="64" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>性能模式</p></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(750.390625, 1368.6240158081055)"><g class="label" transform="translate(-16, -12)"><foreignObject width="32" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>异步</p></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default  " id="flowchart-Business-0" transform="translate(776.89453125, 72)"><rect class="basic label-container" style="fill:#e3f2fd !important" x="-80" y="-39" width="160" height="78"></rect><g class="label" style="" transform="translate(-50, -24)"><rect></rect><foreignObject width="100" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>业务系统<br/>链上交易场景</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-API-1" transform="translate(776.89453125, 274)"><rect class="basic label-container" style="" x="-72.921875" y="-39" width="145.84375" height="78"></rect><g class="label" style="" transform="translate(-42.921875, -24)"><rect></rect><foreignObject width="85.84375" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>HTTP接口<br/>/api/nonces</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Facade-2" transform="translate(776.89453125, 402)"><rect class="basic label-container" style="fill:#fff3e0 !important" x="-71.125" y="-39" width="142.25" height="78"></rect><g class="label" style="" transform="translate(-41.125, -24)"><rect></rect><foreignObject width="82.25" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>Nonce门面<br/>统一入口</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Template-3" transform="translate(776.89453125, 580)"><rect class="basic label-container" style="" x="-85.3515625" y="-39" width="170.703125" height="78"></rect><g class="label" style="" transform="translate(-55.3515625, -24)"><rect></rect><foreignObject width="110.703125" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>执行模板<br/>withNonce方法</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Processor-4" transform="translate(719.39453125, 708)"><rect class="basic label-container" style="" x="-80" y="-39" width="160" height="78"></rect><g class="label" style="" transform="translate(-50, -24)"><rect></rect><foreignObject width="100" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>结果处理器<br/>自动状态流转</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Manager-5" transform="translate(776.89453125, 886)"><rect class="basic label-container" style="fill:#e8f5e9 !important" x="-72" y="-39" width="144" height="78"></rect><g class="label" style="" transform="translate(-42, -24)"><rect></rect><foreignObject width="84" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>引擎管理器<br/>智能路由</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Reliable-6" transform="translate(899.8671875, 1088)"><rect class="basic label-container" style="fill:#c8e6c9 !important" x="-88" y="-39" width="176" height="78"></rect><g class="label" style="" transform="translate(-58, -24)"><rect></rect><foreignObject width="116" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>可靠引擎<br/>数据库串行分配</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Performance-7" transform="translate(665.66796875, 1088)"><rect class="basic label-container" style="fill:#fff9c4 !important" x="-84.453125" y="-39" width="168.90625" height="78"></rect><g class="label" style="" transform="translate(-54.453125, -24)"><rect></rect><foreignObject width="108.90625" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>性能引擎<br/>Redis快速分配</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Redis-8" transform="translate(580.9453125, 1279.3120079040527)"><path d="M0,13.87467319352506 a77.9453125,13.87467319352506 0,0,0 155.890625,0 a77.9453125,13.87467319352506 0,0,0 -155.890625,0 l0,76.87467319352507 a77.9453125,13.87467319352506 0,0,0 155.890625,0 l0,-76.87467319352507" class="basic label-container" style="fill:#ffccbc !important" label-offset-y="13.87467319352506" transform="translate(-77.9453125, -52.3120097902876)"></path><g class="label" style="" transform="translate(-70.4453125, -14)"><rect></rect><foreignObject width="140.890625" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>Redis缓存<br/>计数器/回收池/快照</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Queue-9" transform="translate(750.390625, 1279.3120079040527)"><path d="M0,9.975961538461538 a41.5,9.975961538461538 0,0,0 83,0 a41.5,9.975961538461538 0,0,0 -83,0 l0,72.97596153846155 a41.5,9.975961538461538 0,0,0 83,0 l0,-72.97596153846155" class="basic label-container" style="" label-offset-y="9.975961538461538" transform="translate(-41.5, -46.463942307692314)"></path><g class="label" style="" transform="translate(-34, -14)"><rect></rect><foreignObject width="68" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>刷盘队列<br/>异步事件</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-DB-10" transform="translate(831.7890625, 1632.3455200195312)"><path d="M0,11.481005813167501 a53.078125,11.481005813167501 0,0,0 106.15625,0 a53.078125,11.481005813167501 0,0,0 -106.15625,0 l0,74.4810058131675 a53.078125,11.481005813167501 0,0,0 106.15625,0 l0,-74.4810058131675" class="basic label-container" style="fill:#b2dfdb !important" label-offset-y="11.481005813167501" transform="translate(-53.078125, -48.72150871975125)"></path><g class="label" style="" transform="translate(-45.578125, -14)"><rect></rect><foreignObject width="91.15625" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>PostgreSQL<br/>持久化存储</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Worker-11" transform="translate(333, 1469.6240158081055)"><rect class="basic label-container" style="" x="-80" y="-39" width="160" height="78"></rect><g class="label" style="" transform="translate(-50, -24)"><rect></rect><foreignObject width="100" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>刷盘工作线程<br/>定时批量写入</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Cleanup-12" transform="translate(123, 1469.6240158081055)"><rect class="basic label-container" style="" x="-80" y="-39" width="160" height="78"></rect><g class="label" style="" transform="translate(-50, -24)"><rect></rect><foreignObject width="100" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>数据清理任务<br/>历史数据归档</p></span></div></foreignObject></g></g></g></g></g></svg></div><h2 id='nonce状态生命周期'><span>Nonce状态生命周期</span></h2><div class="md-diagram-panel md-fences-adv-panel" lang="mermaid"><svg id="mermaidChart187" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="statediagram mermaid-svg" style="max-width: 848.1986083984375px;" viewBox="0 0 848.1986083984375 920" role="graphics-document document" aria-roledescription="stateDiagram"><style>#mermaidChart187{font-family:sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaidChart187 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaidChart187 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaidChart187 .error-icon{fill:#552222;}#mermaidChart187 .error-text{fill:#552222;stroke:#552222;}#mermaidChart187 .edge-thickness-normal{stroke-width:1px;}#mermaidChart187 .edge-thickness-thick{stroke-width:3.5px;}#mermaidChart187 .edge-pattern-solid{stroke-dasharray:0;}#mermaidChart187 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaidChart187 .edge-pattern-dashed{stroke-dasharray:3;}#mermaidChart187 .edge-pattern-dotted{stroke-dasharray:2;}#mermaidChart187 .marker{fill:#333333;stroke:#333333;}#mermaidChart187 .marker.cross{stroke:#333333;}#mermaidChart187 svg{font-family:sans-serif;font-size:16px;}#mermaidChart187 p{margin:0;}#mermaidChart187 defs #statediagram-barbEnd{fill:#333333;stroke:#333333;}#mermaidChart187 g.stateGroup text{fill:#9370DB;stroke:none;font-size:10px;}#mermaidChart187 g.stateGroup text{fill:#333;stroke:none;font-size:10px;}#mermaidChart187 g.stateGroup .state-title{font-weight:bolder;fill:#131300;}#mermaidChart187 g.stateGroup rect{fill:#ECECFF;stroke:#9370DB;}#mermaidChart187 g.stateGroup line{stroke:#333333;stroke-width:1;}#mermaidChart187 .transition{stroke:#333333;stroke-width:1;fill:none;}#mermaidChart187 .stateGroup .composit{fill:white;border-bottom:1px;}#mermaidChart187 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px;}#mermaidChart187 .state-note{stroke:#aaaa33;fill:#fff5ad;}#mermaidChart187 .state-note text{fill:black;stroke:none;font-size:10px;}#mermaidChart187 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5;}#mermaidChart187 .edgeLabel .label rect{fill:#ECECFF;opacity:0.5;}#mermaidChart187 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaidChart187 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaidChart187 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaidChart187 .edgeLabel .label text{fill:#333;}#mermaidChart187 .label div .edgeLabel{color:#333;}#mermaidChart187 .stateLabel text{fill:#131300;font-size:10px;font-weight:bold;}#mermaidChart187 .node circle.state-start{fill:#333333;stroke:#333333;}#mermaidChart187 .node .fork-join{fill:#333333;stroke:#333333;}#mermaidChart187 .node circle.state-end{fill:#9370DB;stroke:white;stroke-width:1.5;}#mermaidChart187 .end-state-inner{fill:white;stroke-width:1.5;}#mermaidChart187 .node rect{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaidChart187 .node polygon{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaidChart187 #statediagram-barbEnd{fill:#333333;}#mermaidChart187 .statediagram-cluster rect{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaidChart187 .cluster-label,#mermaidChart187 .nodeLabel{color:#131300;}#mermaidChart187 .statediagram-cluster rect.outer{rx:5px;ry:5px;}#mermaidChart187 .statediagram-state .divider{stroke:#9370DB;}#mermaidChart187 .statediagram-state .title-state{rx:5px;ry:5px;}#mermaidChart187 .statediagram-cluster.statediagram-cluster .inner{fill:white;}#mermaidChart187 .statediagram-cluster.statediagram-cluster-alt .inner{fill:#f0f0f0;}#mermaidChart187 .statediagram-cluster .inner{rx:0;ry:0;}#mermaidChart187 .statediagram-state rect.basic{rx:5px;ry:5px;}#mermaidChart187 .statediagram-state rect.divider{stroke-dasharray:10,10;fill:#f0f0f0;}#mermaidChart187 .note-edge{stroke-dasharray:5;}#mermaidChart187 .statediagram-note rect{fill:#fff5ad;stroke:#aaaa33;stroke-width:1px;rx:0;ry:0;}#mermaidChart187 .statediagram-note rect{fill:#fff5ad;stroke:#aaaa33;stroke-width:1px;rx:0;ry:0;}#mermaidChart187 .statediagram-note text{fill:black;}#mermaidChart187 .statediagram-note .nodeLabel{color:black;}#mermaidChart187 .statediagram .edgeLabel{color:red;}#mermaidChart187 #dependencyStart,#mermaidChart187 #dependencyEnd{fill:#333333;stroke:#333333;stroke-width:1;}#mermaidChart187 .statediagramTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaidChart187 :root{--mermaid-alt-font-family:sans-serif;}</style><g><defs><marker id="mermaidChart187_stateDiagram-barbEnd" refX="19" refY="7" markerWidth="20" markerHeight="14" markerUnits="userSpaceOnUse" orient="auto"><path d="M 19,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><g class="root"><g class="clusters"><g class="note-cluster" id="RESERVED----parent"><rect x="8" y="324" width="259.578125" height="176" fill="none"></rect></g><g class="note-cluster" id="USED----parent"><rect x="272.6361358165741" y="736" width="273.78125" height="176" fill="none"></rect></g><g class="note-cluster" id="RECYCLABLE----parent"><rect x="566.4173858165741" y="736" width="273.78125" height="176" fill="none"></rect></g></g><g class="edgePaths"><path d="M379.191,22L379.191,28.167C379.191,34.333,379.191,46.667,379.191,59C379.191,71.333,379.191,83.667,379.191,89.833L379.191,96" id="edge0" class=" edge-thickness-normal edge-pattern-solid transition" style="fill:none;" marker-end="url(#mermaidChart187_stateDiagram-barbEnd)"></path><path d="M379.191,136L379.191,142.167C379.191,148.333,379.191,160.667,379.191,173C379.191,185.333,379.191,197.667,379.191,203.833L379.191,210" id="edge1" class=" edge-thickness-normal edge-pattern-solid transition" style="fill:none;" marker-end="url(#mermaidChart187_stateDiagram-barbEnd)"></path><path d="M379.191,250L379.191,256.167C379.191,262.333,379.191,274.667,379.191,287C379.191,299.333,379.191,311.667,379.191,329.167C379.191,346.667,379.191,369.333,379.191,380.667L379.191,392" id="edge2" class=" edge-thickness-normal edge-pattern-solid transition" style="fill:none;" marker-end="url(#mermaidChart187_stateDiagram-barbEnd)"></path><path d="M365.757,432L358.143,443.333C350.53,454.667,335.304,477.333,327.691,496.833C320.078,516.333,320.078,532.667,320.078,549C320.078,565.333,320.078,581.667,320.078,589.833L320.078,598" id="edge3" class=" edge-thickness-normal edge-pattern-solid transition" style="fill:none;" marker-end="url(#mermaidChart187_stateDiagram-barbEnd)"></path><path d="M429.191,430.617L460.248,442.181C491.304,453.745,553.418,476.872,584.474,496.603C615.531,516.333,615.531,532.667,625.92,549C636.309,565.333,657.087,581.667,667.476,589.833L677.865,598" id="edge4" class=" edge-thickness-normal edge-pattern-solid transition" style="fill:none;" marker-end="url(#mermaidChart187_stateDiagram-barbEnd)"></path><path d="M713.486,598L717.642,589.833C721.798,581.667,730.109,565.333,734.265,549C738.421,532.667,738.421,516.333,738.421,493.5C738.421,470.667,738.421,441.333,738.421,412C738.421,382.667,738.421,353.333,738.421,332.5C738.421,311.667,738.421,299.333,687.529,285.091C636.636,270.849,534.851,254.699,483.959,246.624L433.066,238.548" id="edge5" class=" edge-thickness-normal edge-pattern-solid transition" style="fill:none;" marker-end="url(#mermaidChart187_stateDiagram-barbEnd)"></path><path d="M294.151,638L283.564,646.167C272.977,654.333,251.803,670.667,241.216,687C230.629,703.333,230.629,719.667,230.629,741.333C230.629,763,230.629,790,230.629,803.5L230.629,817" id="edge6" class=" edge-thickness-normal edge-pattern-solid transition" style="fill:none;" marker-end="url(#mermaidChart187_stateDiagram-barbEnd)"></path><path d="M325.316,242.721L294.062,250.101C262.807,257.481,200.298,272.24,169.044,285.787C137.789,299.333,137.789,311.667,137.789,322C137.789,332.333,137.789,340.667,137.789,344.833L137.789,349" id="RESERVED-RESERVED----note-7" class=" edge-thickness-normal edge-pattern-solid transition note-edge" style="fill:none;"></path><path d="M346.005,638L356.592,646.167C367.179,654.333,388.353,670.667,398.94,687C409.527,703.333,409.527,719.667,409.527,732C409.527,744.333,409.527,752.667,409.527,756.833L409.527,761" id="USED-USED----note-8" class=" edge-thickness-normal edge-pattern-solid transition note-edge" style="fill:none;"></path><path d="M703.308,638L703.308,646.167C703.308,654.333,703.308,670.667,703.308,687C703.308,703.333,703.308,719.667,703.308,732C703.308,744.333,703.308,752.667,703.308,756.833L703.308,761" id="RECYCLABLE-RECYCLABLE----note-9" class=" edge-thickness-normal edge-pattern-solid transition note-edge" style="fill:none;"></path></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(379.19140625, 59)"><g class="label" transform="translate(-55.125, -12)"><foreignObject width="110.25" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>业务请求Nonce</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(379.19140625, 173)"><g class="label" transform="translate(-32, -12)"><foreignObject width="64" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>分配成功</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(379.19140625, 287)"><g class="label" transform="translate(-48, -12)"><foreignObject width="96" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>返回给业务方</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(320.078125, 549)"><g class="label" transform="translate(-48, -24)"><foreignObject width="96" height="48"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>链上交易成功<br/>记录交易哈希</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(615.5306670665741, 549)"><g class="label" transform="translate(-50.2265625, -24)"><foreignObject width="100.453125" height="48"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>交易失败/超时<br/>记录失败原因</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(738.4212920665741, 412)"><g class="label" transform="translate(-40, -24)"><foreignObject width="80" height="48"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>下次分配时<br/>优先复用</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(230.6294891834259, 687)"><g class="label" transform="translate(-32, -24)"><foreignObject width="64" height="48"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>永久占用<br/>不再使用</p></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="state-root_start-0" transform="translate(379.19140625, 15)"><circle class="state-start" r="7" width="14" height="14"></circle></g><g class="node  statediagram-state " id="state-分配中-1" transform="translate(379.19140625, 116)"><rect class="basic label-container" style="" rx="5" ry="5" x="-34" y="-20" width="68" height="40"></rect><g class="label" style="" transform="translate(-26, -12)"><rect></rect><foreignObject width="52" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>分配中</p></span></div></foreignObject></g></g><g class="node  statediagram-state " id="state-RESERVED-7" transform="translate(379.19140625, 230)"><rect class="basic label-container" style="" rx="5" ry="5" x="-53.875" y="-20" width="107.75" height="40"></rect><g class="label" style="" transform="translate(-45.875, -12)"><rect></rect><foreignObject width="91.75" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>RESERVED</p></span></div></foreignObject></g></g><g class="node  statediagram-state " id="state-业务处理中-4" transform="translate(379.19140625, 412)"><rect class="basic label-container" style="" rx="5" ry="5" x="-50" y="-20" width="100" height="40"></rect><g class="label" style="" transform="translate(-42, -12)"><rect></rect><foreignObject width="84" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>业务处理中</p></span></div></foreignObject></g></g><g class="node  statediagram-state " id="state-USED-8" transform="translate(320.078125, 618)"><rect class="basic label-container" style="" rx="5" ry="5" x="-32.2265625" y="-20" width="64.453125" height="40"></rect><g class="label" style="" transform="translate(-24.2265625, -12)"><rect></rect><foreignObject width="48.453125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>USED</p></span></div></foreignObject></g></g><g class="node  statediagram-state " id="state-RECYCLABLE-9" transform="translate(703.3080108165741, 618)"><rect class="basic label-container" style="" rx="5" ry="5" x="-62.9140625" y="-20" width="125.828125" height="40"></rect><g class="label" style="" transform="translate(-54.9140625, -12)"><rect></rect><foreignObject width="109.828125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>RECYCLABLE</p></span></div></foreignObject></g></g><g class="node default" id="state-root_end-6" transform="translate(230.6294891834259, 824)"><g><path d="M7 0 C7 0.40517908122283747, 6.964012880168563 0.816513743121899, 6.893654271085456 1.2155372436685123 C6.823295662002349 1.6145607442151257, 6.716427752933756 2.013397210557766, 6.5778483455013586 2.394141003279681 C6.439268938068961 2.7748847960015954, 6.26476736710249 3.149104622578984, 6.062177826491071 3.4999999999999996 C5.859588285879653 3.8508953774210153, 5.622755194947063 4.189128084166967, 5.362311101832846 4.499513267805774 C5.10186700871863 4.809898451444582, 4.809898451444583 5.10186700871863, 4.499513267805775 5.362311101832846 C4.189128084166968 5.622755194947063, 3.8508953774210166 5.859588285879652, 3.500000000000001 6.06217782649107 C3.149104622578985 6.264767367102489, 2.7748847960015963 6.439268938068961, 2.3941410032796817 6.5778483455013586 C2.013397210557767 6.716427752933756, 1.6145607442151264 6.823295662002349, 1.2155372436685128 6.893654271085456 C0.8165137431218992 6.964012880168563, 0.4051790812228379 7, 4.286263797015736e-16 7 C-0.405179081222837 7, -0.8165137431218985 6.964012880168563, -1.2155372436685121 6.893654271085456 C-1.6145607442151257 6.823295662002349, -2.013397210557766 6.716427752933756, -2.394141003279681 6.5778483455013586 C-2.7748847960015954 6.439268938068961, -3.1491046225789834 6.26476736710249, -3.4999999999999987 6.062177826491071 C-3.850895377421014 5.859588285879653, -4.189128084166966 5.6227551949470636, -4.499513267805773 5.362311101832848 C-4.809898451444581 5.101867008718632, -5.101867008718627 4.809898451444586, -5.362311101832843 4.499513267805779 C-5.622755194947058 4.189128084166971, -5.859588285879649 3.8508953774210206, -6.062177826491068 3.5000000000000053 C-6.264767367102486 3.14910462257899, -6.439268938068958 2.774884796001602, -6.577848345501356 2.394141003279688 C-6.716427752933754 2.0133972105577738, -6.823295662002347 1.614560744215134, -6.893654271085454 1.215537243668521 C-6.9640128801685615 0.816513743121908, -6.999999999999999 0.4051790812228472, -7 1.0183126166254463e-14 C-7.000000000000001 -0.40517908122282686, -6.964012880168565 -0.8165137431218878, -6.893654271085459 -1.215537243668501 C-6.823295662002352 -1.6145607442151142, -6.716427752933759 -2.0133972105577542, -6.577848345501363 -2.394141003279669 C-6.439268938068967 -2.7748847960015834, -6.264767367102496 -3.149104622578972, -6.062177826491078 -3.4999999999999876 C-5.859588285879661 -3.8508953774210033, -5.6227551949470715 -4.1891280841669545, -5.362311101832856 -4.499513267805763 C-5.10186700871864 -4.809898451444571, -4.809898451444594 -5.10186700871862, -4.499513267805787 -5.362311101832836 C-4.189128084166979 -5.622755194947053, -3.850895377421028 -5.859588285879644, -3.5000000000000133 -6.062177826491063 C-3.1491046225789985 -6.264767367102483, -2.774884796001611 -6.439268938068955, -2.3941410032796973 -6.577848345501353 C-2.0133972105577835 -6.716427752933751, -1.6145607442151435 -6.823295662002345, -1.2155372436685306 -6.893654271085453 C-0.8165137431219176 -6.9640128801685615, -0.40517908122285695 -6.999999999999999, -1.9937625952807352e-14 -7 C0.4051790812228171 -7.000000000000001, 0.8165137431218781 -6.964012880168565, 1.2155372436684913 -6.89365427108546 C1.6145607442151044 -6.823295662002354, 2.013397210557745 -6.716427752933763, 2.3941410032796595 -6.5778483455013665 C2.774884796001574 -6.43926893806897, 3.149104622578963 -6.2647673671025, 3.499999999999979 -6.062177826491083 C3.8508953774209953 -5.859588285879665, 4.189128084166947 -5.622755194947077, 4.499513267805756 -5.362311101832862 C4.809898451444564 -5.1018670087186475, 5.101867008718613 -4.809898451444602, 5.362311101832829 -4.499513267805796 C5.622755194947046 -4.189128084166989, 5.859588285879637 -3.8508953774210393, 6.062177826491056 -3.500000000000025 C6.2647673671024755 -3.1491046225790105, 6.439268938068949 -2.774884796001623, 6.577848345501348 -2.3941410032797092 C6.716427752933747 -2.0133972105577955, 6.823295662002342 -1.6145607442151562, 6.893654271085451 -1.2155372436685434 C6.96401288016856 -0.8165137431219307, 6.982275711847575 -0.2025895406114567, 7 -3.2800750208310675e-14 C7.017724288152425 0.2025895406113911, 7.017724288152424 -0.2025895406114242, 7 0" stroke="none" stroke-width="0" fill="#ECECFF" style=""></path><path d="M7 0 C7 0.40517908122283747, 6.964012880168563 0.816513743121899, 6.893654271085456 1.2155372436685123 C6.823295662002349 1.6145607442151257, 6.716427752933756 2.013397210557766, 6.5778483455013586 2.394141003279681 C6.439268938068961 2.7748847960015954, 6.26476736710249 3.149104622578984, 6.062177826491071 3.4999999999999996 C5.859588285879653 3.8508953774210153, 5.622755194947063 4.189128084166967, 5.362311101832846 4.499513267805774 C5.10186700871863 4.809898451444582, 4.809898451444583 5.10186700871863, 4.499513267805775 5.362311101832846 C4.189128084166968 5.622755194947063, 3.8508953774210166 5.859588285879652, 3.500000000000001 6.06217782649107 C3.149104622578985 6.264767367102489, 2.7748847960015963 6.439268938068961, 2.3941410032796817 6.5778483455013586 C2.013397210557767 6.716427752933756, 1.6145607442151264 6.823295662002349, 1.2155372436685128 6.893654271085456 C0.8165137431218992 6.964012880168563, 0.4051790812228379 7, 4.286263797015736e-16 7 C-0.405179081222837 7, -0.8165137431218985 6.964012880168563, -1.2155372436685121 6.893654271085456 C-1.6145607442151257 6.823295662002349, -2.013397210557766 6.716427752933756, -2.394141003279681 6.5778483455013586 C-2.7748847960015954 6.439268938068961, -3.1491046225789834 6.26476736710249, -3.4999999999999987 6.062177826491071 C-3.850895377421014 5.859588285879653, -4.189128084166966 5.6227551949470636, -4.499513267805773 5.362311101832848 C-4.809898451444581 5.101867008718632, -5.101867008718627 4.809898451444586, -5.362311101832843 4.499513267805779 C-5.622755194947058 4.189128084166971, -5.859588285879649 3.8508953774210206, -6.062177826491068 3.5000000000000053 C-6.264767367102486 3.14910462257899, -6.439268938068958 2.774884796001602, -6.577848345501356 2.394141003279688 C-6.716427752933754 2.0133972105577738, -6.823295662002347 1.614560744215134, -6.893654271085454 1.215537243668521 C-6.9640128801685615 0.816513743121908, -6.999999999999999 0.4051790812228472, -7 1.0183126166254463e-14 C-7.000000000000001 -0.40517908122282686, -6.964012880168565 -0.8165137431218878, -6.893654271085459 -1.215537243668501 C-6.823295662002352 -1.6145607442151142, -6.716427752933759 -2.0133972105577542, -6.577848345501363 -2.394141003279669 C-6.439268938068967 -2.7748847960015834, -6.264767367102496 -3.149104622578972, -6.062177826491078 -3.4999999999999876 C-5.859588285879661 -3.8508953774210033, -5.6227551949470715 -4.1891280841669545, -5.362311101832856 -4.499513267805763 C-5.10186700871864 -4.809898451444571, -4.809898451444594 -5.10186700871862, -4.499513267805787 -5.362311101832836 C-4.189128084166979 -5.622755194947053, -3.850895377421028 -5.859588285879644, -3.5000000000000133 -6.062177826491063 C-3.1491046225789985 -6.264767367102483, -2.774884796001611 -6.439268938068955, -2.3941410032796973 -6.577848345501353 C-2.0133972105577835 -6.716427752933751, -1.6145607442151435 -6.823295662002345, -1.2155372436685306 -6.893654271085453 C-0.8165137431219176 -6.9640128801685615, -0.40517908122285695 -6.999999999999999, -1.9937625952807352e-14 -7 C0.4051790812228171 -7.000000000000001, 0.8165137431218781 -6.964012880168565, 1.2155372436684913 -6.89365427108546 C1.6145607442151044 -6.823295662002354, 2.013397210557745 -6.716427752933763, 2.3941410032796595 -6.5778483455013665 C2.774884796001574 -6.43926893806897, 3.149104622578963 -6.2647673671025, 3.499999999999979 -6.062177826491083 C3.8508953774209953 -5.859588285879665, 4.189128084166947 -5.622755194947077, 4.499513267805756 -5.362311101832862 C4.809898451444564 -5.1018670087186475, 5.101867008718613 -4.809898451444602, 5.362311101832829 -4.499513267805796 C5.622755194947046 -4.189128084166989, 5.859588285879637 -3.8508953774210393, 6.062177826491056 -3.500000000000025 C6.2647673671024755 -3.1491046225790105, 6.439268938068949 -2.774884796001623, 6.577848345501348 -2.3941410032797092 C6.716427752933747 -2.0133972105577955, 6.823295662002342 -1.6145607442151562, 6.893654271085451 -1.2155372436685434 C6.96401288016856 -0.8165137431219307, 6.982275711847575 -0.2025895406114567, 7 -3.2800750208310675e-14 C7.017724288152425 0.2025895406113911, 7.017724288152424 -0.2025895406114242, 7 0" stroke="#333333" stroke-width="2" fill="none" style=""></path><g><path d="M2.5 0 C2.5 0.14470681472244193, 2.487147457203058 0.29161205111496386, 2.46201938253052 0.4341204441673258 C2.436891307857982 0.5766288372196877, 2.3987241974763416 0.7190704323420595, 2.3492315519647713 0.8550503583141718 C2.299738906453201 0.991030284286284, 2.2374169168223177 1.124680222349637, 2.165063509461097 1.2499999999999998 C2.092710102099876 1.3753197776503625, 2.0081268553382365 1.496117172916774, 1.915111107797445 1.6069690242163481 C1.8220953602566536 1.7178208755159223, 1.7178208755159226 1.8220953602566536, 1.6069690242163484 1.915111107797445 C1.4961171729167742 2.0081268553382365, 1.375319777650363 2.0927101020998755, 1.2500000000000002 2.1650635094610964 C1.1246802223496375 2.2374169168223172, 0.9910302842862845 2.2997389064532, 0.8550503583141721 2.349231551964771 C0.7190704323420597 2.3987241974763416, 0.576628837219688 2.436891307857982, 0.43412044416732604 2.46201938253052 C0.291612051114964 2.487147457203058, 0.14470681472244212 2.5, 1.5308084989341916e-16 2.5 C-0.1447068147224418 2.5, -0.2916120511149638 2.487147457203058, -0.43412044416732576 2.46201938253052 C-0.5766288372196877 2.436891307857982, -0.7190704323420595 2.3987241974763416, -0.8550503583141718 2.3492315519647713 C-0.991030284286284 2.299738906453201, -1.124680222349637 2.2374169168223177, -1.2499999999999996 2.165063509461097 C-1.375319777650362 2.092710102099876, -1.4961171729167735 2.008126855338237, -1.6069690242163475 1.9151111077974459 C-1.7178208755159214 1.8220953602566548, -1.8220953602566525 1.7178208755159234, -1.9151111077974439 1.6069690242163495 C-2.008126855338235 1.4961171729167755, -2.0927101020998746 1.3753197776503645, -2.1650635094610955 1.250000000000002 C-2.2374169168223164 1.1246802223496395, -2.2997389064531992 0.9910302842862865, -2.34923155196477 0.8550503583141743 C-2.3987241974763407 0.7190704323420621, -2.436891307857981 0.5766288372196907, -2.4620193825305194 0.434120444167329 C-2.487147457203058 0.29161205111496724, -2.5 0.14470681472244545, -2.5 3.636830773662308e-15 C-2.5 -0.14470681472243818, -2.4871474572030587 -0.2916120511149599, -2.4620193825305208 -0.4341204441673218 C-2.436891307857983 -0.5766288372196837, -2.398724197476343 -0.7190704323420553, -2.3492315519647726 -0.8550503583141675 C-2.2997389064532023 -0.9910302842862798, -2.23741691682232 -1.1246802223496328, -2.165063509461099 -1.2499999999999956 C-2.092710102099878 -1.3753197776503583, -2.00812685533824 -1.4961171729167695, -1.9151111077974488 -1.606969024216344 C-1.8220953602566576 -1.7178208755159183, -1.7178208755159263 -1.8220953602566499, -1.6069690242163523 -1.9151111077974416 C-1.4961171729167784 -2.0081268553382334, -1.3753197776503672 -2.092710102099873, -1.2500000000000047 -2.165063509461094 C-1.1246802223496422 -2.2374169168223155, -0.9910302842862897 -2.299738906453198, -0.8550503583141776 -2.3492315519647686 C-0.7190704323420656 -2.3987241974763394, -0.5766288372196942 -2.4368913078579806, -0.43412044416733236 -2.462019382530519 C-0.29161205111497057 -2.4871474572030574, -0.1447068147224489 -2.4999999999999996, -7.120580697431198e-15 -2.5 C0.14470681472243463 -2.5000000000000004, 0.29161205111495647 -2.487147457203059, 0.4341204441673183 -2.4620193825305217 C0.5766288372196802 -2.436891307857984, 0.7190704323420518 -2.3987241974763442, 0.8550503583141642 -2.349231551964774 C0.9910302842862766 -2.2997389064532037, 1.1246802223496295 -2.2374169168223212, 1.2499999999999925 -2.165063509461101 C1.3753197776503554 -2.0927101020998804, 1.4961171729167668 -2.008126855338242, 1.6069690242163412 -1.915111107797451 C1.7178208755159157 -1.82209536025666, 1.8220953602566472 -1.7178208755159294, 1.915111107797439 -1.6069690242163557 C2.0081268553382308 -1.496117172916782, 2.09271010209987 -1.3753197776503712, 2.1650635094610915 -1.2500000000000089 C2.237416916822313 -1.1246802223496466, 2.299738906453196 -0.9910302842862939, 2.3492315519647673 -0.855050358314182 C2.3987241974763385 -0.71907043234207, 2.4368913078579792 -0.5766288372196986, 2.462019382530518 -0.4341204441673369 C2.487147457203057 -0.29161205111497523, 2.4936698970884197 -0.07235340736123454, 2.5 -1.1714553645825241e-14 C2.5063301029115803 0.07235340736121111, 2.50633010291158 -0.07235340736122292, 2.5 0" stroke="none" stroke-width="0" fill="#9370DB" style=""></path><path d="M2.5 0 C2.5 0.14470681472244193, 2.487147457203058 0.29161205111496386, 2.46201938253052 0.4341204441673258 C2.436891307857982 0.5766288372196877, 2.3987241974763416 0.7190704323420595, 2.3492315519647713 0.8550503583141718 C2.299738906453201 0.991030284286284, 2.2374169168223177 1.124680222349637, 2.165063509461097 1.2499999999999998 C2.092710102099876 1.3753197776503625, 2.0081268553382365 1.496117172916774, 1.915111107797445 1.6069690242163481 C1.8220953602566536 1.7178208755159223, 1.7178208755159226 1.8220953602566536, 1.6069690242163484 1.915111107797445 C1.4961171729167742 2.0081268553382365, 1.375319777650363 2.0927101020998755, 1.2500000000000002 2.1650635094610964 C1.1246802223496375 2.2374169168223172, 0.9910302842862845 2.2997389064532, 0.8550503583141721 2.349231551964771 C0.7190704323420597 2.3987241974763416, 0.576628837219688 2.436891307857982, 0.43412044416732604 2.46201938253052 C0.291612051114964 2.487147457203058, 0.14470681472244212 2.5, 1.5308084989341916e-16 2.5 C-0.1447068147224418 2.5, -0.2916120511149638 2.487147457203058, -0.43412044416732576 2.46201938253052 C-0.5766288372196877 2.436891307857982, -0.7190704323420595 2.3987241974763416, -0.8550503583141718 2.3492315519647713 C-0.991030284286284 2.299738906453201, -1.124680222349637 2.2374169168223177, -1.2499999999999996 2.165063509461097 C-1.375319777650362 2.092710102099876, -1.4961171729167735 2.008126855338237, -1.6069690242163475 1.9151111077974459 C-1.7178208755159214 1.8220953602566548, -1.8220953602566525 1.7178208755159234, -1.9151111077974439 1.6069690242163495 C-2.008126855338235 1.4961171729167755, -2.0927101020998746 1.3753197776503645, -2.1650635094610955 1.250000000000002 C-2.2374169168223164 1.1246802223496395, -2.2997389064531992 0.9910302842862865, -2.34923155196477 0.8550503583141743 C-2.3987241974763407 0.7190704323420621, -2.436891307857981 0.5766288372196907, -2.4620193825305194 0.434120444167329 C-2.487147457203058 0.29161205111496724, -2.5 0.14470681472244545, -2.5 3.636830773662308e-15 C-2.5 -0.14470681472243818, -2.4871474572030587 -0.2916120511149599, -2.4620193825305208 -0.4341204441673218 C-2.436891307857983 -0.5766288372196837, -2.398724197476343 -0.7190704323420553, -2.3492315519647726 -0.8550503583141675 C-2.2997389064532023 -0.9910302842862798, -2.23741691682232 -1.1246802223496328, -2.165063509461099 -1.2499999999999956 C-2.092710102099878 -1.3753197776503583, -2.00812685533824 -1.4961171729167695, -1.9151111077974488 -1.606969024216344 C-1.8220953602566576 -1.7178208755159183, -1.7178208755159263 -1.8220953602566499, -1.6069690242163523 -1.9151111077974416 C-1.4961171729167784 -2.0081268553382334, -1.3753197776503672 -2.092710102099873, -1.2500000000000047 -2.165063509461094 C-1.1246802223496422 -2.2374169168223155, -0.9910302842862897 -2.299738906453198, -0.8550503583141776 -2.3492315519647686 C-0.7190704323420656 -2.3987241974763394, -0.5766288372196942 -2.4368913078579806, -0.43412044416733236 -2.462019382530519 C-0.29161205111497057 -2.4871474572030574, -0.1447068147224489 -2.4999999999999996, -7.120580697431198e-15 -2.5 C0.14470681472243463 -2.5000000000000004, 0.29161205111495647 -2.487147457203059, 0.4341204441673183 -2.4620193825305217 C0.5766288372196802 -2.436891307857984, 0.7190704323420518 -2.3987241974763442, 0.8550503583141642 -2.349231551964774 C0.9910302842862766 -2.2997389064532037, 1.1246802223496295 -2.2374169168223212, 1.2499999999999925 -2.165063509461101 C1.3753197776503554 -2.0927101020998804, 1.4961171729167668 -2.008126855338242, 1.6069690242163412 -1.915111107797451 C1.7178208755159157 -1.82209536025666, 1.8220953602566472 -1.7178208755159294, 1.915111107797439 -1.6069690242163557 C2.0081268553382308 -1.496117172916782, 2.09271010209987 -1.3753197776503712, 2.1650635094610915 -1.2500000000000089 C2.237416916822313 -1.1246802223496466, 2.299738906453196 -0.9910302842862939, 2.3492315519647673 -0.855050358314182 C2.3987241974763385 -0.71907043234207, 2.4368913078579792 -0.5766288372196986, 2.462019382530518 -0.4341204441673369 C2.487147457203057 -0.29161205111497523, 2.4936698970884197 -0.07235340736123454, 2.5 -1.1714553645825241e-14 C2.5063301029115803 0.07235340736121111, 2.50633010291158 -0.07235340736122292, 2.5 0" stroke="#9370DB" stroke-width="2" fill="none" style=""></path></g></g></g><g class="node statediagram-note " id="state-RESERVED----note-7" transform="translate(137.7890625, 412)"><g class="basic label-container"><path d="M-94.7890625 -63 L94.7890625 -63 L94.7890625 63 L-94.7890625 63" stroke="none" stroke-width="0" fill="#fff5ad" style=""></path><path d="M-94.7890625 -63 C-39.37339556781076 -63, 16.04227136437848 -63, 94.7890625 -63 M-94.7890625 -63 C-28.206661600745576 -63, 38.37573929850885 -63, 94.7890625 -63 M94.7890625 -63 C94.7890625 -19.34516790092517, 94.7890625 24.30966419814966, 94.7890625 63 M94.7890625 -63 C94.7890625 -16.695914556145084, 94.7890625 29.608170887709832, 94.7890625 63 M94.7890625 63 C29.752091435310504 63, -35.28487962937899 63, -94.7890625 63 M94.7890625 63 C25.9373822884902 63, -42.9142979230196 63, -94.7890625 63 M-94.7890625 63 C-94.7890625 16.13079452766003, -94.7890625 -30.73841094467994, -94.7890625 -63 M-94.7890625 63 C-94.7890625 33.9246074734409, -94.7890625 4.849214946881794, -94.7890625 -63" stroke="#aaaa33" stroke-width="1.3" fill="none" style=""></path></g><g class="label" style="" transform="translate(-79.7890625, -48)"><rect></rect><foreignObject width="159.578125" height="96"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>【已分配状态】<br/>- 已分配给业务方<br/>- 等待链上确认<br/>- 有超时保护（30秒）</p></span></div></foreignObject></g></g><g class="node statediagram-note " id="state-USED----note-8" transform="translate(409.5267608165741, 824)"><g class="basic label-container"><path d="M-101.890625 -63 L101.890625 -63 L101.890625 63 L-101.890625 63" stroke="none" stroke-width="0" fill="#fff5ad" style=""></path><path d="M-101.890625 -63 C-57.204447682326524 -63, -12.518270364653048 -63, 101.890625 -63 M-101.890625 -63 C-37.5933720855257 -63, 26.7038808289486 -63, 101.890625 -63 M101.890625 -63 C101.890625 -30.28997462348228, 101.890625 2.42005075303544, 101.890625 63 M101.890625 -63 C101.890625 -26.162352102207834, 101.890625 10.675295795584333, 101.890625 63 M101.890625 63 C45.04075372523997 63, -11.809117549520053 63, -101.890625 63 M101.890625 63 C32.780225520350626 63, -36.33017395929875 63, -101.890625 63 M-101.890625 63 C-101.890625 19.15189893312376, -101.890625 -24.69620213375248, -101.890625 -63 M-101.890625 63 C-101.890625 34.8877148485501, -101.890625 6.7754296971001935, -101.890625 -63" stroke="#aaaa33" stroke-width="1.3" fill="none" style=""></path></g><g class="label" style="" transform="translate(-86.890625, -48)"><rect></rect><foreignObject width="173.78125" height="96"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>【已使用状态】<br/>- 链上交易已确认<br/>- 永久占用此Nonce<br/>- 记录交易哈希用于对账</p></span></div></foreignObject></g></g><g class="node statediagram-note " id="state-RECYCLABLE----note-9" transform="translate(703.3080108165741, 824)"><g class="basic label-container"><path d="M-101.890625 -63 L101.890625 -63 L101.890625 63 L-101.890625 63" stroke="none" stroke-width="0" fill="#fff5ad" style=""></path><path d="M-101.890625 -63 C-38.88660392779672 -63, 24.11741714440656 -63, 101.890625 -63 M-101.890625 -63 C-29.754755087712297 -63, 42.381114824575405 -63, 101.890625 -63 M101.890625 -63 C101.890625 -34.1748125455878, 101.890625 -5.3496250911755965, 101.890625 63 M101.890625 -63 C101.890625 -19.329798780406065, 101.890625 24.34040243918787, 101.890625 63 M101.890625 63 C24.338525598269214 63, -53.21357380346157 63, -101.890625 63 M101.890625 63 C22.97747071372632 63, -55.93568357254736 63, -101.890625 63 M-101.890625 63 C-101.890625 17.94640478732901, -101.890625 -27.107190425341983, -101.890625 -63 M-101.890625 63 C-101.890625 13.513901557243607, -101.890625 -35.97219688551279, -101.890625 -63" stroke="#aaaa33" stroke-width="1.3" fill="none" style=""></path></g><g class="label" style="" transform="translate(-86.890625, -48)"><rect></rect><foreignObject width="173.78125" height="96"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>【可回收状态】<br/>- 交易失败或放弃<br/>- 可以重新分配<br/>- 优先复用（避免跳号）</p></span></div></foreignObject></g></g></g></g></g></svg></div><h2 id='双模式运行机制'><span>双模式运行机制</span></h2><div class="md-diagram-panel md-fences-adv-panel" lang="mermaid"><svg id="mermaidChart188" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart mermaid-svg" style="max-width: 236.234375px;" viewBox="0 0 236.234375 1743" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaidChart188{font-family:sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaidChart188 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaidChart188 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaidChart188 .error-icon{fill:#552222;}#mermaidChart188 .error-text{fill:#552222;stroke:#552222;}#mermaidChart188 .edge-thickness-normal{stroke-width:1px;}#mermaidChart188 .edge-thickness-thick{stroke-width:3.5px;}#mermaidChart188 .edge-pattern-solid{stroke-dasharray:0;}#mermaidChart188 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaidChart188 .edge-pattern-dashed{stroke-dasharray:3;}#mermaidChart188 .edge-pattern-dotted{stroke-dasharray:2;}#mermaidChart188 .marker{fill:#333333;stroke:#333333;}#mermaidChart188 .marker.cross{stroke:#333333;}#mermaidChart188 svg{font-family:sans-serif;font-size:16px;}#mermaidChart188 p{margin:0;}#mermaidChart188 .label{font-family:sans-serif;color:#333;}#mermaidChart188 .cluster-label text{fill:#333;}#mermaidChart188 .cluster-label span{color:#333;}#mermaidChart188 .cluster-label span p{background-color:transparent;}#mermaidChart188 .label text,#mermaidChart188 span{fill:#333;color:#333;}#mermaidChart188 .node rect,#mermaidChart188 .node circle,#mermaidChart188 .node ellipse,#mermaidChart188 .node polygon,#mermaidChart188 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaidChart188 .rough-node .label text,#mermaidChart188 .node .label text,#mermaidChart188 .image-shape .label,#mermaidChart188 .icon-shape .label{text-anchor:middle;}#mermaidChart188 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaidChart188 .rough-node .label,#mermaidChart188 .node .label,#mermaidChart188 .image-shape .label,#mermaidChart188 .icon-shape .label{text-align:center;}#mermaidChart188 .node.clickable{cursor:pointer;}#mermaidChart188 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaidChart188 .arrowheadPath{fill:#333333;}#mermaidChart188 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaidChart188 .flowchart-link{stroke:#333333;fill:none;}#mermaidChart188 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaidChart188 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaidChart188 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaidChart188 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaidChart188 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaidChart188 .cluster text{fill:#333;}#mermaidChart188 .cluster span{color:#333;}#mermaidChart188 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaidChart188 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaidChart188 rect.text{fill:none;stroke-width:0;}#mermaidChart188 .icon-shape,#mermaidChart188 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaidChart188 .icon-shape p,#mermaidChart188 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaidChart188 .icon-shape rect,#mermaidChart188 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaidChart188 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaidChart188 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaidChart188 :root{--mermaid-alt-font-family:sans-serif;}</style><g><marker id="mermaidChart188_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart188_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart188_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaidChart188_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaidChart188_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart188_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g class="root" transform="translate(6.6640625, 0)"><g class="clusters"><g class="cluster " id="subGraph1" data-look="classic"><rect style="" x="8" y="8" width="206.90625" height="903"></rect><g class="cluster-label " transform="translate(46.34375, 8)"><foreignObject width="130.21875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>性能模式 - 高吞吐</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path d="M111.453,99.5L111.453,137L111.453,170.5" id="L_P1_P2_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path><path d="M111.453,228.5L111.453,266L111.453,299.5" id="L_P2_P3_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path><path d="M111.453,357.5L111.453,395L111.453,428.5" id="L_P3_P4_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path><path d="M111.453,486.5L111.453,524L111.453,557.5" id="L_P4_P5_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path><path d="M111.453,615.5L111.453,653L111.453,686.5" id="L_P5_P6_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path><path d="M111.453,744.5L111.453,782L111.453,815.5" id="L_P6_P7_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default  " id="flowchart-P1-10" transform="translate(111.453125, 72.5)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>业务请求</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-P2-11" transform="translate(111.453125, 201.5)"><rect class="basic label-container" style="" x="-56" y="-27" width="112" height="54"></rect><g class="label" style="" transform="translate(-26, -12)"><rect></rect><foreignObject width="52" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>获取锁</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-P3-13" transform="translate(111.453125, 330.5)"><rect class="basic label-container" style="fill:#fff9c4 !important" x="-68.453125" y="-27" width="136.90625" height="54"></rect><g class="label" style="" transform="translate(-38.453125, -12)"><rect></rect><foreignObject width="76.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>Redis操作</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-P4-15" transform="translate(111.453125, 459.5)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>快速分配</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-P5-17" transform="translate(111.453125, 588.5)"><rect class="basic label-container" style="fill:#fff9c4 !important" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>立即返回</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-P6-19" transform="translate(111.453125, 717.5)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>异步刷盘</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-P7-21" transform="translate(111.453125, 846.5)"><rect class="basic label-container" style="fill:#b2dfdb !important" x="-67.1171875" y="-27" width="134.234375" height="54"></rect><g class="label" style="" transform="translate(-37.1171875, -12)"><rect></rect><foreignObject width="74.234375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>批量写DB</p></span></div></foreignObject></g></g></g></g><g class="root" transform="translate(0, 953)"><g class="clusters"><g class="cluster " id="subGraph0" data-look="classic"><rect style="" x="8" y="8" width="220.234375" height="774"></rect><g class="cluster-label " transform="translate(45.0078125, 8)"><foreignObject width="146.21875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>可靠模式 - 强一致性</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path d="M118.117,99.5L118.117,137L118.117,170.5" id="L_R1_R2_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path><path d="M118.117,228.5L118.117,266L118.117,299.5" id="L_R2_R3_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path><path d="M118.117,357.5L118.117,395L118.117,428.5" id="L_R3_R4_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path><path d="M118.117,486.5L118.117,524L118.117,557.5" id="L_R4_R5_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path><path d="M118.117,615.5L118.117,653L118.117,686.5" id="L_R5_R6_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart188_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default  " id="flowchart-R1-0" transform="translate(118.1171875, 72.5)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>业务请求</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-R2-1" transform="translate(118.1171875, 201.5)"><rect class="basic label-container" style="" x="-56" y="-27" width="112" height="54"></rect><g class="label" style="" transform="translate(-26, -12)"><rect></rect><foreignObject width="52" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>获取锁</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-R3-3" transform="translate(118.1171875, 330.5)"><rect class="basic label-container" style="fill:#c8e6c9 !important" x="-72" y="-27" width="144" height="54"></rect><g class="label" style="" transform="translate(-42, -12)"><rect></rect><foreignObject width="84" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>数据库事务</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-R4-5" transform="translate(118.1171875, 459.5)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>串行分配</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-R5-7" transform="translate(118.1171875, 588.5)"><rect class="basic label-container" style="fill:#c8e6c9 !important" x="-75.1171875" y="-27" width="150.234375" height="54"></rect><g class="label" style="" transform="translate(-45.1171875, -12)"><rect></rect><foreignObject width="90.234375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>立即写入DB</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-R6-9" transform="translate(118.1171875, 717.5)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>返回结果</p></span></div></foreignObject></g></g></g></g></g></g></g></svg></div><h2 id='模式切换策略'><span>模式切换策略</span></h2><div class="md-diagram-panel md-fences-adv-panel" lang="mermaid"><svg id="mermaidChart189" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart mermaid-svg" style="max-width: 555.5625px;" viewBox="0 0 555.5625 979.90625" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaidChart189{font-family:sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaidChart189 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaidChart189 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaidChart189 .error-icon{fill:#552222;}#mermaidChart189 .error-text{fill:#552222;stroke:#552222;}#mermaidChart189 .edge-thickness-normal{stroke-width:1px;}#mermaidChart189 .edge-thickness-thick{stroke-width:3.5px;}#mermaidChart189 .edge-pattern-solid{stroke-dasharray:0;}#mermaidChart189 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaidChart189 .edge-pattern-dashed{stroke-dasharray:3;}#mermaidChart189 .edge-pattern-dotted{stroke-dasharray:2;}#mermaidChart189 .marker{fill:#333333;stroke:#333333;}#mermaidChart189 .marker.cross{stroke:#333333;}#mermaidChart189 svg{font-family:sans-serif;font-size:16px;}#mermaidChart189 p{margin:0;}#mermaidChart189 .label{font-family:sans-serif;color:#333;}#mermaidChart189 .cluster-label text{fill:#333;}#mermaidChart189 .cluster-label span{color:#333;}#mermaidChart189 .cluster-label span p{background-color:transparent;}#mermaidChart189 .label text,#mermaidChart189 span{fill:#333;color:#333;}#mermaidChart189 .node rect,#mermaidChart189 .node circle,#mermaidChart189 .node ellipse,#mermaidChart189 .node polygon,#mermaidChart189 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaidChart189 .rough-node .label text,#mermaidChart189 .node .label text,#mermaidChart189 .image-shape .label,#mermaidChart189 .icon-shape .label{text-anchor:middle;}#mermaidChart189 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaidChart189 .rough-node .label,#mermaidChart189 .node .label,#mermaidChart189 .image-shape .label,#mermaidChart189 .icon-shape .label{text-align:center;}#mermaidChart189 .node.clickable{cursor:pointer;}#mermaidChart189 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaidChart189 .arrowheadPath{fill:#333333;}#mermaidChart189 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaidChart189 .flowchart-link{stroke:#333333;fill:none;}#mermaidChart189 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaidChart189 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaidChart189 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaidChart189 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaidChart189 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaidChart189 .cluster text{fill:#333;}#mermaidChart189 .cluster span{color:#333;}#mermaidChart189 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaidChart189 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaidChart189 rect.text{fill:none;stroke-width:0;}#mermaidChart189 .icon-shape,#mermaidChart189 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaidChart189 .icon-shape p,#mermaidChart189 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaidChart189 .icon-shape rect,#mermaidChart189 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaidChart189 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaidChart189 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaidChart189 :root{--mermaid-alt-font-family:sans-serif;}</style><g><marker id="mermaidChart189_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart189_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart189_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaidChart189_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaidChart189_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart189_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M410.063,47L410.063,72L410.063,93" id="L_Start_Reliable_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path><path d="M371.768,175L335.438,212L335.438,245" id="L_Reliable_DualWrite_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path><path d="M335.438,327L335.438,364L335.438,397" id="L_DualWrite_Performance_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path><path d="M288.227,479L243.438,516L243.884,549.5" id="L_Performance_Check_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path><path d="M197.711,670.18L88,752.906L88,797.906" id="L_Check_Stay_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path><path d="M269.625,690.719L298,752.906L298,785.906" id="L_Check_Degrade_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path><path d="M340.204,479L344.727,516L424.24,592.677" id="L_Performance_Drain_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path><path d="M467.563,595.453L467.563,516L467.563,440L467.563,364L467.563,288L467.563,212L441.982,178.19" id="L_Drain_Reliable_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path><path d="M88,855.906L88,892.906L179.759,922.81" id="L_Stay_Monitor_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path><path d="M298,867.906L298,892.906L276.536,915.035" id="L_Degrade_Monitor_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path><path d="M311.563,924.79L413,892.906L413,828.906L413,752.906L295.172,670.741" id="L_Monitor_Check_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart189_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(335.4375, 212)"><g class="label" transform="translate(-48, -12)"><foreignObject width="96" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>需要性能优化</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(335.4375, 364)"><g class="label" transform="translate(-32, -12)"><foreignObject width="64" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>验证通过</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(243.4375, 516)"><g class="label" transform="translate(-40, -12)"><foreignObject width="80" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>监控健康度</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(88, 752.90625)"><g class="label" transform="translate(-16, -12)"><foreignObject width="32" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>健康</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(298, 752.90625)"><g class="label" transform="translate(-16, -12)"><foreignObject width="32" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>异常</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(344.7265625, 516)"><g class="label" transform="translate(-32, -12)"><foreignObject width="64" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>需要维护</p></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default  " id="flowchart-Start-0" transform="translate(410.0625, 27.5)"><rect class="basic label-container" style="" rx="19.5" ry="19.5" x="-46.375" y="-19.5" width="92.75" height="39"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>系统启动</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Reliable-1" transform="translate(410.0625, 136)"><rect class="basic label-container" style="fill:#c8e6c9 !important" x="-96" y="-39" width="192" height="78"></rect><g class="label" style="" transform="translate(-66, -24)"><rect></rect><foreignObject width="132" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>可靠模式<br/>所有流量走数据库</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-DualWrite-3" transform="translate(335.4375, 288)"><rect class="basic label-container" style="fill:#fff4e1 !important" x="-97.125" y="-39" width="194.25" height="78"></rect><g class="label" style="" transform="translate(-67.125, -24)"><rect></rect><foreignObject width="134.25" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>双写模式<br/>数据库+Redis镜像</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Performance-5" transform="translate(335.4375, 440)"><rect class="basic label-container" style="fill:#fff9c4 !important" x="-84.453125" y="-39" width="168.90625" height="78"></rect><g class="label" style="" transform="translate(-54.453125, -24)"><rect></rect><foreignObject width="108.90625" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>性能模式<br/>Redis为主流程</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Check-7" transform="translate(243.4375, 634.453125)"><polygon points="81.453125,0 162.90625,-81.453125 81.453125,-162.90625 0,-81.453125" class="label-container" transform="translate(-81.453125,81.453125)"></polygon><g class="label" style="" transform="translate(-54.453125, -12)"><rect></rect><foreignObject width="108.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>性能链路健康?</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Stay-9" transform="translate(88, 828.90625)"><rect class="basic label-container" style="" x="-80" y="-27" width="160" height="54"></rect><g class="label" style="" transform="translate(-50, -12)"><rect></rect><foreignObject width="100" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>保持性能模式</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Degrade-11" transform="translate(298, 828.90625)"><rect class="basic label-container" style="fill:#ffccbc !important" x="-80" y="-39" width="160" height="78"></rect><g class="label" style="" transform="translate(-50, -24)"><rect></rect><foreignObject width="100" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>自动降级<br/>回退可靠模式</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Drain-13" transform="translate(467.5625, 634.453125)"><rect class="basic label-container" style="fill:#f3e5f5 !important" x="-80" y="-39" width="160" height="78"></rect><g class="label" style="" transform="translate(-50, -24)"><rect></rect><foreignObject width="100" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>排空模式<br/>等待队列清空</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Monitor-17" transform="translate(247.5625, 944.90625)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>持续监控</p></span></div></foreignObject></g></g></g></g></g></svg></div><h2 id='异常处理和容错'><span>异常处理和容错</span></h2><div class="md-diagram-panel md-fences-adv-panel" lang="mermaid"><svg id="mermaidChart190" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart mermaid-svg" style="max-width: 840.5px;" viewBox="0 0 840.5 806.90625" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaidChart190{font-family:sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaidChart190 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaidChart190 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaidChart190 .error-icon{fill:#552222;}#mermaidChart190 .error-text{fill:#552222;stroke:#552222;}#mermaidChart190 .edge-thickness-normal{stroke-width:1px;}#mermaidChart190 .edge-thickness-thick{stroke-width:3.5px;}#mermaidChart190 .edge-pattern-solid{stroke-dasharray:0;}#mermaidChart190 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaidChart190 .edge-pattern-dashed{stroke-dasharray:3;}#mermaidChart190 .edge-pattern-dotted{stroke-dasharray:2;}#mermaidChart190 .marker{fill:#333333;stroke:#333333;}#mermaidChart190 .marker.cross{stroke:#333333;}#mermaidChart190 svg{font-family:sans-serif;font-size:16px;}#mermaidChart190 p{margin:0;}#mermaidChart190 .label{font-family:sans-serif;color:#333;}#mermaidChart190 .cluster-label text{fill:#333;}#mermaidChart190 .cluster-label span{color:#333;}#mermaidChart190 .cluster-label span p{background-color:transparent;}#mermaidChart190 .label text,#mermaidChart190 span{fill:#333;color:#333;}#mermaidChart190 .node rect,#mermaidChart190 .node circle,#mermaidChart190 .node ellipse,#mermaidChart190 .node polygon,#mermaidChart190 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaidChart190 .rough-node .label text,#mermaidChart190 .node .label text,#mermaidChart190 .image-shape .label,#mermaidChart190 .icon-shape .label{text-anchor:middle;}#mermaidChart190 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaidChart190 .rough-node .label,#mermaidChart190 .node .label,#mermaidChart190 .image-shape .label,#mermaidChart190 .icon-shape .label{text-align:center;}#mermaidChart190 .node.clickable{cursor:pointer;}#mermaidChart190 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaidChart190 .arrowheadPath{fill:#333333;}#mermaidChart190 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaidChart190 .flowchart-link{stroke:#333333;fill:none;}#mermaidChart190 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaidChart190 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaidChart190 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaidChart190 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaidChart190 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaidChart190 .cluster text{fill:#333;}#mermaidChart190 .cluster span{color:#333;}#mermaidChart190 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaidChart190 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaidChart190 rect.text{fill:none;stroke-width:0;}#mermaidChart190 .icon-shape,#mermaidChart190 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaidChart190 .icon-shape p,#mermaidChart190 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaidChart190 .icon-shape rect,#mermaidChart190 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaidChart190 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaidChart190 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaidChart190 :root{--mermaid-alt-font-family:sans-serif;}</style><g><marker id="mermaidChart190_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart190_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart190_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaidChart190_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaidChart190_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaidChart190_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M317,62L317,87L317,108" id="L_Request_Execute_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M287.144,166L259.5,191L259.922,212.501" id="L_Execute_Success_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M213.931,301.337L16,383.906L16,481.906L16,579.906L16,655.906L16,719.906L63.845,743.158" id="L_Success_Return_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M298.517,308.889L406,383.906L406.447,417.407" id="L_Success_Handle_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M361.19,498.097L123,579.906L123,612.906" id="L_Handle_Recycle_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M376.156,513.063L309,579.906L309,612.906" id="L_Handle_Timeout_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M436.844,513.063L503,579.906L503,612.906" id="L_Handle_Degrade_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M454.289,495.617L760.5,579.906L760.5,612.906" id="L_Handle_Alert_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M123,694.906L123,719.906L123,740.906" id="L_Recycle_Return_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M309,694.906L309,719.906L190.852,752.937" id="L_Timeout_Return_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M503,694.906L503,719.906L527.677,742.223" id="L_Degrade_Retry_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M590.356,744.906L618,719.906L618,655.906L618,579.906L618,481.906L618,383.906L618,281.453L618,191L384.942,150.737" id="L_Retry_Execute_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path><path d="M760.5,694.906L760.5,719.906L760.5,740.906" id="L_Alert_Stop_0" class=" edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaidChart190_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(16, 579.90625)"><g class="label" transform="translate(-8, -12)"><foreignObject width="16" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>是</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(406, 383.90625)"><g class="label" transform="translate(-8, -12)"><foreignObject width="16" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>否</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(123, 579.90625)"><g class="label" transform="translate(-32, -12)"><foreignObject width="64" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>业务失败</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(309, 579.90625)"><g class="label" transform="translate(-16, -12)"><foreignObject width="32" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>超时</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(503, 579.90625)"><g class="label" transform="translate(-36.453125, -12)"><foreignObject width="72.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>Redis异常</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(760.5, 579.90625)"><g class="label" transform="translate(-40, -12)"><foreignObject width="80" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "><p>数据库异常</p></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel "></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default  " id="flowchart-Request-0" transform="translate(317, 35)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>业务请求</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Execute-1" transform="translate(317, 139)"><rect class="basic label-container" style="fill:#e1f5ff !important" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>执行分配</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Success-3" transform="translate(259.5, 281.453125)"><polygon points="65.453125,0 130.90625,-65.453125 65.453125,-130.90625 0,-65.453125" class="label-container" transform="translate(-65.453125,65.453125)"></polygon><g class="label" style="" transform="translate(-38.453125, -12)"><rect></rect><foreignObject width="76.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>执行成功?</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Return-5" transform="translate(123, 771.90625)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>正常返回</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Handle-7" transform="translate(406, 481.90625)"><polygon points="61,0 122,-61 61,-122 0,-61" class="label-container" transform="translate(-61,61)"></polygon><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>异常处理</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Recycle-9" transform="translate(123, 655.90625)"><rect class="basic label-container" style="fill:#c8e6c9 !important" x="-72" y="-39" width="144" height="78"></rect><g class="label" style="" transform="translate(-42, -24)"><rect></rect><foreignObject width="84" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>标记可回收<br/>允许重试</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Timeout-11" transform="translate(309, 655.90625)"><rect class="basic label-container" style="" x="-64" y="-39" width="128" height="78"></rect><g class="label" style="" transform="translate(-34, -24)"><rect></rect><foreignObject width="68" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>自动回收<br/>防止泄漏</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Degrade-13" transform="translate(503, 655.90625)"><rect class="basic label-container" style="fill:#ffccbc !important" x="-80" y="-39" width="160" height="78"></rect><g class="label" style="" transform="translate(-50, -24)"><rect></rect><foreignObject width="100" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>自动降级<br/>切换可靠模式</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Alert-15" transform="translate(760.5, 655.90625)"><rect class="basic label-container" style="fill:#fce4ec !important" x="-72" y="-39" width="144" height="78"></rect><g class="label" style="" transform="translate(-42, -24)"><rect></rect><foreignObject width="84" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>告警通知<br/>系统不可用</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Retry-21" transform="translate(560.5, 771.90625)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>重试分配</p></span></div></foreignObject></g></g><g class="node default  " id="flowchart-Stop-25" transform="translate(760.5, 771.90625)"><rect class="basic label-container" style="" x="-64" y="-27" width="128" height="54"></rect><g class="label" style="" transform="translate(-34, -12)"><rect></rect><foreignObject width="68" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel "><p>停止服务</p></span></div></foreignObject></g></g></g></g></g></svg></div><h2 id='数据流转全景'><span>数据流转全景</span></h2><div class="md-diagram-panel md-fences-adv-panel" lang="mermaid"><svg id="mermaidChart196" width="3884.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="4795" viewBox="-14.5 -8 3884.5 4795" role="graphics-document document" aria-roledescription="sequence" class="mermaid-svg"><rect x="863" y="4237" fill="rgb(235,245,255)" width="2933" height="460" class="rect"></rect><rect x="1612" y="3464" fill="rgb(240,240,240)" width="1751.5" height="765" class="rect"></rect><rect x="1047" y="2478" fill="rgb(255,235,210)" width="1365" height="840" class="rect"></rect><rect x="1047" y="2221" fill="rgb(210,230,255)" width="2300.5" height="249" class="rect"></rect><rect x="1047" y="698" fill="rgb(255,235,210)" width="1373" height="1255" class="rect"></rect><rect x="1047" y="211" fill="rgb(210,230,255)" width="2300.5" height="479" class="rect"></rect><g><rect x="3712" y="4713" fill="#eaeaea" stroke="#666" width="150" height="65" name="Monitor" rx="3" ry="3" class="actor actor-bottom"></rect><text x="3787" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="3787" dy="0">监控平台</tspan></text></g><g><rect x="3458" y="4713" fill="#eaeaea" stroke="#666" width="204" height="65" name="ModeCtrl" rx="3" ry="3" class="actor actor-bottom"></rect><text x="3560" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="3560" dy="0">模式管理入口\n(运维接口)</tspan></text></g><g><rect x="3253" y="4713" fill="#eaeaea" stroke="#666" width="155" height="65" name="DB" rx="3" ry="3" class="actor actor-bottom"></rect><text x="3330.5" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="3330.5" dy="0">数据库\n(Postgres)</tspan></text></g><g><rect x="2610.5" y="4713" fill="#eaeaea" stroke="#666" width="220" height="65" name="FlushW" rx="3" ry="3" class="actor actor-bottom"></rect><text x="2720.5" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="2720.5" dy="0">刷盘任务\n(定时写回数据库)</tspan></text></g><g><rect x="2213.5" y="4713" fill="#eaeaea" stroke="#666" width="347" height="65" name="Redis" rx="3" ry="3" class="actor actor-bottom"></rect><text x="2387" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="2387" dy="0">Redis\n(锁/计数器/預取池/可复用池/快照/队列)</tspan></text></g><g><rect x="1966.5" y="4713" fill="#eaeaea" stroke="#666" width="197" height="65" name="LockC" rx="3" ry="3" class="actor actor-bottom"></rect><text x="2065" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="2065" dy="0">加锁协调器\n(基于Redis)</tspan></text></g><g><rect x="1502" y="4713" fill="#eaeaea" stroke="#666" width="286" height="65" name="PerfEng" rx="3" ry="3" class="actor actor-bottom"></rect><text x="1645" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="1645" dy="0">性能模式引擎\n(Redis为主, 批量預取)</tspan></text></g><g><rect x="1232" y="4713" fill="#eaeaea" stroke="#666" width="220" height="65" name="Reliable" rx="3" ry="3" class="actor actor-bottom"></rect><text x="1342" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="1342" dy="0">可靠模式引擎\n(数据库为主)</tspan></text></g><g><rect x="946" y="4713" fill="#eaeaea" stroke="#666" width="236" height="65" name="EngineM" rx="3" ry="3" class="actor actor-bottom"></rect><text x="1064" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="1064" dy="0">引擎管理器\n(路由与模式切换)</tspan></text></g><g><rect x="599.5" y="4713" fill="#eaeaea" stroke="#666" width="255" height="65" name="Tpl" rx="3" ry="3" class="actor actor-bottom"></rect><text x="727" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="727" dy="0">执行模板\n(拿号+执行业务+回收)</tspan></text></g><g><rect x="331" y="4713" fill="#eaeaea" stroke="#666" width="150" height="65" name="Facade" rx="3" ry="3" class="actor actor-bottom"></rect><text x="406" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="406" dy="0">Nonce组件门面</tspan></text></g><g><rect x="0" y="4713" fill="#eaeaea" stroke="#666" width="188" height="65" name="Biz" rx="3" ry="3" class="actor actor-bottom"></rect><text x="94" y="4745.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="94" dy="0">业务系统\n(调用方服务)</tspan></text></g><g><line id="actor314" x1="3787" y1="65" x2="3787" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Monitor"></line><g id="root-314"><rect x="3712" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Monitor" rx="3" ry="3" class="actor actor-top"></rect><text x="3787" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="3787" dy="0">监控平台</tspan></text></g></g><g><line id="actor313" x1="3560" y1="65" x2="3560" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="ModeCtrl"></line><g id="root-313"><rect x="3458" y="0" fill="#eaeaea" stroke="#666" width="204" height="65" name="ModeCtrl" rx="3" ry="3" class="actor actor-top"></rect><text x="3560" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="3560" dy="0">模式管理入口\n(运维接口)</tspan></text></g></g><g><line id="actor312" x1="3330.5" y1="65" x2="3330.5" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="DB"></line><g id="root-312"><rect x="3253" y="0" fill="#eaeaea" stroke="#666" width="155" height="65" name="DB" rx="3" ry="3" class="actor actor-top"></rect><text x="3330.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="3330.5" dy="0">数据库\n(Postgres)</tspan></text></g></g><g><line id="actor311" x1="2720.5" y1="65" x2="2720.5" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="FlushW"></line><g id="root-311"><rect x="2610.5" y="0" fill="#eaeaea" stroke="#666" width="220" height="65" name="FlushW" rx="3" ry="3" class="actor actor-top"></rect><text x="2720.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="2720.5" dy="0">刷盘任务\n(定时写回数据库)</tspan></text></g></g><g><line id="actor310" x1="2387" y1="65" x2="2387" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Redis"></line><g id="root-310"><rect x="2213.5" y="0" fill="#eaeaea" stroke="#666" width="347" height="65" name="Redis" rx="3" ry="3" class="actor actor-top"></rect><text x="2387" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="2387" dy="0">Redis\n(锁/计数器/預取池/可复用池/快照/队列)</tspan></text></g></g><g><line id="actor309" x1="2065" y1="65" x2="2065" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="LockC"></line><g id="root-309"><rect x="1966.5" y="0" fill="#eaeaea" stroke="#666" width="197" height="65" name="LockC" rx="3" ry="3" class="actor actor-top"></rect><text x="2065" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="2065" dy="0">加锁协调器\n(基于Redis)</tspan></text></g></g><g><line id="actor308" x1="1645" y1="65" x2="1645" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="PerfEng"></line><g id="root-308"><rect x="1502" y="0" fill="#eaeaea" stroke="#666" width="286" height="65" name="PerfEng" rx="3" ry="3" class="actor actor-top"></rect><text x="1645" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="1645" dy="0">性能模式引擎\n(Redis为主, 批量預取)</tspan></text></g></g><g><line id="actor307" x1="1342" y1="65" x2="1342" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Reliable"></line><g id="root-307"><rect x="1232" y="0" fill="#eaeaea" stroke="#666" width="220" height="65" name="Reliable" rx="3" ry="3" class="actor actor-top"></rect><text x="1342" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="1342" dy="0">可靠模式引擎\n(数据库为主)</tspan></text></g></g><g><line id="actor306" x1="1064" y1="65" x2="1064" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="EngineM"></line><g id="root-306"><rect x="946" y="0" fill="#eaeaea" stroke="#666" width="236" height="65" name="EngineM" rx="3" ry="3" class="actor actor-top"></rect><text x="1064" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="1064" dy="0">引擎管理器\n(路由与模式切换)</tspan></text></g></g><g><line id="actor305" x1="727" y1="65" x2="727" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Tpl"></line><g id="root-305"><rect x="599.5" y="0" fill="#eaeaea" stroke="#666" width="255" height="65" name="Tpl" rx="3" ry="3" class="actor actor-top"></rect><text x="727" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="727" dy="0">执行模板\n(拿号+执行业务+回收)</tspan></text></g></g><g><line id="actor304" x1="406" y1="65" x2="406" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Facade"></line><g id="root-304"><rect x="331" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Facade" rx="3" ry="3" class="actor actor-top"></rect><text x="406" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="406" dy="0">Nonce组件门面</tspan></text></g></g><g><line id="actor303" x1="94" y1="65" x2="94" y2="4713" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Biz"></line><g id="root-303"><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="188" height="65" name="Biz" rx="3" ry="3" class="actor actor-top"></rect><text x="94" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: sans-serif;"><tspan x="94" dy="0">业务系统\n(调用方服务)</tspan></text></g></g><style>#mermaidChart196{font-family:sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaidChart196 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaidChart196 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaidChart196 .error-icon{fill:#552222;}#mermaidChart196 .error-text{fill:#552222;stroke:#552222;}#mermaidChart196 .edge-thickness-normal{stroke-width:1px;}#mermaidChart196 .edge-thickness-thick{stroke-width:3.5px;}#mermaidChart196 .edge-pattern-solid{stroke-dasharray:0;}#mermaidChart196 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaidChart196 .edge-pattern-dashed{stroke-dasharray:3;}#mermaidChart196 .edge-pattern-dotted{stroke-dasharray:2;}#mermaidChart196 .marker{fill:#333333;stroke:#333333;}#mermaidChart196 .marker.cross{stroke:#333333;}#mermaidChart196 svg{font-family:sans-serif;font-size:16px;}#mermaidChart196 p{margin:0;}#mermaidChart196 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaidChart196 text.actor&gt;tspan{fill:black;stroke:none;}#mermaidChart196 .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaidChart196 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaidChart196 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaidChart196 #arrowhead path{fill:#333;stroke:#333;}#mermaidChart196 .sequenceNumber{fill:white;}#mermaidChart196 #sequencenumber{fill:#333;}#mermaidChart196 #crosshead path{fill:#333;stroke:#333;}#mermaidChart196 .messageText{fill:#333;stroke:none;}#mermaidChart196 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaidChart196 .labelText,#mermaidChart196 .labelText&gt;tspan{fill:black;stroke:none;}#mermaidChart196 .loopText,#mermaidChart196 .loopText&gt;tspan{fill:black;stroke:none;}#mermaidChart196 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaidChart196 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaidChart196 .noteText,#mermaidChart196 .noteText&gt;tspan{fill:black;stroke:none;}#mermaidChart196 .activation0{fill:#f4f4f4;stroke:#666;}#mermaidChart196 .activation1{fill:#f4f4f4;stroke:#666;}#mermaidChart196 .activation2{fill:#f4f4f4;stroke:#666;}#mermaidChart196 .actorPopupMenu{position:absolute;}#mermaidChart196 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaidChart196 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaidChart196 .actor-man circle,#mermaidChart196 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#mermaidChart196 :root{--mermaid-alt-font-family:sans-serif;}</style><g></g><defs><symbol id="computer" width="24" height="24"><path transform="scale(.5)" d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z"></path></symbol></defs><defs><symbol id="database" fill-rule="evenodd" clip-rule="evenodd"><path transform="scale(.5)" d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z"></path></symbol></defs><defs><symbol id="clock" width="24" height="24"><path transform="scale(.5)" d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z"></path></symbol></defs><defs><marker id="arrowhead" refX="7.9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto-start-reverse"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="4" refY="4.5"><path fill="none" stroke="#000000" stroke-width="1pt" d="M 1,2 L 6,7 M 6,2 L 1,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head" refX="15.5" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><g><line x1="1055" y1="227" x2="3339.5" y2="227" class="loopLine"></line><line x1="3339.5" y1="227" x2="3339.5" y2="682" class="loopLine"></line><line x1="1055" y1="682" x2="3339.5" y2="682" class="loopLine"></line><line x1="1055" y1="227" x2="1055" y2="682" class="loopLine"></line><line x1="1055" y1="687" x2="3339.5" y2="687" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="1055,227 1105,227 1105,240 1096.6,247 1055,247" class="labelBox"></polygon><text x="1080" y="240" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">alt</text><text x="2222.25" y="243" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;"><tspan x="2222.25">[当前为可靠模式]</tspan></text><text x="2197.25" y="703" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">[当前为性能模式]</text></g><g><line x1="1479" y1="1143" x2="2396" y2="1143" class="loopLine"></line><line x1="2396" y1="1143" x2="2396" y2="1791" class="loopLine"></line><line x1="1479" y1="1791" x2="2396" y2="1791" class="loopLine"></line><line x1="1479" y1="1143" x2="1479" y2="1791" class="loopLine"></line><line x1="1479" y1="1341" x2="2396" y2="1341" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="1479,1143 1529,1143 1529,1156 1520.6,1163 1479,1163" class="labelBox"></polygon><text x="1504" y="1156" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">alt</text><text x="1962.5" y="1159" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;"><tspan x="1962.5">[預取池中有剩余]</tspan></text><text x="1937.5" y="1357" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">[預取池为空或不足]</text></g><g><line x1="1471" y1="893" x2="2404" y2="893" class="loopLine"></line><line x1="2404" y1="893" x2="2404" y2="1799" class="loopLine"></line><line x1="1471" y1="1799" x2="2404" y2="1799" class="loopLine"></line><line x1="1471" y1="893" x2="1471" y2="1799" class="loopLine"></line><line x1="1471" y1="1015" x2="2404" y2="1015" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="1471,893 1521,893 1521,906 1512.6,913 1471,913" class="labelBox"></polygon><text x="1496" y="906" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">alt</text><text x="1962.5" y="909" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;"><tspan x="1962.5">[有可复用 nonce]</tspan></text><text x="1937.5" y="1031" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">[没有可复用 nonce]</text></g><g><line x1="1055" y1="714" x2="2412" y2="714" class="loopLine"></line><line x1="2412" y1="714" x2="2412" y2="1945" class="loopLine"></line><line x1="1055" y1="1945" x2="2412" y2="1945" class="loopLine"></line><line x1="1055" y1="714" x2="1055" y2="1945" class="loopLine"></line><polygon points="1055,714 1105,714 1105,727 1096.6,734 1055,734" class="labelBox"></polygon><text x="1080" y="727" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">opt</text><text x="1758.5" y="730" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;"><tspan x="1758.5">[当前为性能模式]</tspan></text></g><g><line x1="1055" y1="2237" x2="3339.5" y2="2237" class="loopLine"></line><line x1="3339.5" y1="2237" x2="3339.5" y2="2462" class="loopLine"></line><line x1="1055" y1="2462" x2="3339.5" y2="2462" class="loopLine"></line><line x1="1055" y1="2237" x2="1055" y2="2462" class="loopLine"></line><polygon points="1055,2237 1105,2237 1105,2250 1096.6,2257 1055,2257" class="labelBox"></polygon><text x="1080" y="2250" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">opt</text><text x="2222.25" y="2253" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;"><tspan x="2222.25">[当前为可靠模式]</tspan></text></g><g><line x1="1636" y1="2811" x2="2396" y2="2811" class="loopLine"></line><line x1="2396" y1="2811" x2="2396" y2="3256" class="loopLine"></line><line x1="1636" y1="3256" x2="2396" y2="3256" class="loopLine"></line><line x1="1636" y1="2811" x2="1636" y2="3256" class="loopLine"></line><line x1="1636" y1="2995" x2="2396" y2="2995" class="loopLine" style="stroke-dasharray: 3, 3;"></line><line x1="1636" y1="3174" x2="2396" y2="3174" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="1636,2811 1686,2811 1686,2824 1677.6,2831 1636,2831" class="labelBox"></polygon><text x="1661" y="2824" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">alt</text><text x="2041" y="2827" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;"><tspan x="2041">[业务确认成功]</tspan></text><text x="2016" y="3011" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">[明确失败且不再重试]</text><text x="2016" y="3190" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">[业务计划自行重试]</text></g><g><line x1="1055" y1="2494" x2="2404" y2="2494" class="loopLine"></line><line x1="2404" y1="2494" x2="2404" y2="3310" class="loopLine"></line><line x1="1055" y1="3310" x2="2404" y2="3310" class="loopLine"></line><line x1="1055" y1="2494" x2="1055" y2="3310" class="loopLine"></line><polygon points="1055,2494 1105,2494 1105,2507 1096.6,2514 1055,2514" class="labelBox"></polygon><text x="1080" y="2507" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">opt</text><text x="1754.5" y="2510" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;"><tspan x="1754.5">[当前为性能模式]</tspan></text></g><g><line x1="1636" y1="3700" x2="3339.5" y2="3700" class="loopLine"></line><line x1="3339.5" y1="3700" x2="3339.5" y2="4058" class="loopLine"></line><line x1="1636" y1="4058" x2="3339.5" y2="4058" class="loopLine"></line><line x1="1636" y1="3700" x2="1636" y2="4058" class="loopLine"></line><line x1="1636" y1="3884" x2="3339.5" y2="3884" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="1636,3700 1686,3700 1686,3713 1677.6,3720 1636,3720" class="labelBox"></polygon><text x="1661" y="3713" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">alt</text><text x="2512.75" y="3716" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;"><tspan x="2512.75">[事务成功]</tspan></text><text x="2487.75" y="3900" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">[事务失败]</text></g><g><line x1="1628" y1="3613" x2="3347.5" y2="3613" class="loopLine"></line><line x1="3347.5" y1="3613" x2="3347.5" y2="4213" class="loopLine"></line><line x1="1628" y1="4213" x2="3347.5" y2="4213" class="loopLine"></line><line x1="1628" y1="3613" x2="1628" y2="4213" class="loopLine"></line><line x1="1628" y1="4071" x2="3347.5" y2="4071" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="1628,3613 1678,3613 1678,3626 1669.6,3633 1628,3633" class="labelBox"></polygon><text x="1653" y="3626" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">alt</text><text x="2512.75" y="3629" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;"><tspan x="2512.75">[有事件]</tspan></text><text x="2487.75" y="4087" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">[无事件]</text></g><g><line x1="1620" y1="3480" x2="3355.5" y2="3480" class="loopLine"></line><line x1="3355.5" y1="3480" x2="3355.5" y2="4221" class="loopLine"></line><line x1="1620" y1="4221" x2="3355.5" y2="4221" class="loopLine"></line><line x1="1620" y1="3480" x2="1620" y2="4221" class="loopLine"></line><polygon points="1620,3480 1670,3480 1670,3493 1661.6,3500 1620,3500" class="labelBox"></polygon><text x="1645" y="3493" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">loop</text><text x="2512.75" y="3496" text-anchor="middle" class="loopText" style="font-family: sans-serif; font-size: 16px; font-weight: 400;"><tspan x="2512.75">[定时刷盘]</tspan></text></g><text x="249" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">1 业务系统发起需要 nonce 的请求</text><line x1="95" y1="111" x2="402" y2="111" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="565" y="126" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">2 执行模板接管本次请求</text><line x1="407" y1="157" x2="723" y2="157" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="894" y="172" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">3 为当前用户申请一个安全 nonce</text><line x1="728" y1="203" x2="1060" y2="203" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1202" y="275" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">4R 路由到可靠模式引擎</text><line x1="1065" y1="306" x2="1338" y2="306" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1702" y="321" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5R 为该用户申请分布式锁</text><line x1="1343" y1="352" x2="2061" y2="352" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2225" y="367" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">6R 在 Redis 中加锁</text><line x1="2066" y1="398" x2="2383" y2="398" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2228" y="413" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">7R 返回加锁结果</text><line x1="2386" y1="444" x2="2069" y2="444" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1705" y="459" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">8R 锁成功后继续</text><line x1="2064" y1="490" x2="1346" y2="490" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="2335" y="505" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">9R 在数据库事务中加载或初始化用户状态</text><line x1="1343" y1="536" x2="3326.5" y2="536" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2335" y="551" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">10R 优先复用可回收 nonce 否则使用本地计数生成新 nonce</text><line x1="1343" y1="582" x2="3326.5" y2="582" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2338" y="597" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">11R 返回本次预留的 nonce 记录</text><line x1="3329.5" y1="628" x2="1346" y2="628" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1205" y="643" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">12R 返回用户和 nonce</text><line x1="1341" y1="674" x2="1068" y2="674" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1353" y="762" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">4P 路由到性能模式引擎</text><line x1="1065" y1="793" x2="1641" y2="793" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="808" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.1 尝试从可复用池获取最早可用的旧 nonce</text><line x1="1646" y1="839" x2="2383" y2="839" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2018" y="854" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.2 返回可复用 nonce 或空</text><line x1="2386" y1="885" x2="1649" y2="885" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1646" y="941" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.3 使用该旧 nonce 作为本次分配结果</text><path d="M 1646,972 C 1706,962 1706,1002 1646,992" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="2015" y="1058" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.4 尝试从預取池获取一个預取 nonce</text><line x1="1646" y1="1089" x2="2383" y2="1089" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2018" y="1104" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.5 返回預取 nonce 或空</text><line x1="2386" y1="1135" x2="1649" y2="1135" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1646" y="1191" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.6 使用此預取 nonce</text><path d="M 1646,1222 C 1706,1212 1706,1252 1646,1242" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1646" y="1267" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.7 统计剩余量, 接近耗尽时触发下一批預取</text><path d="M 1646,1298 C 1706,1288 1706,1328 1646,1318" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1854" y="1384" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.8 为该用户短暂加锁, 准备批量补货</text><line x1="1646" y1="1415" x2="2061" y2="1415" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2225" y="1430" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.9 在 Redis 中加锁</text><line x1="2066" y1="1461" x2="2383" y2="1461" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2228" y="1476" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.10 锁成功</text><line x1="2386" y1="1507" x2="2069" y2="1507" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1857" y="1522" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.11 可以安全执行批量操作</text><line x1="2064" y1="1553" x2="1649" y2="1553" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="2015" y="1568" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.12 根据数据库中 nextLocalNonce\n初始化或校准计数器</text><line x1="1646" y1="1599" x2="2383" y2="1599" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="1614" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.13 使用计数器一次批量生成一段连续 nonce\n数量由配置决定, 例如 32 个</text><line x1="1646" y1="1645" x2="2383" y2="1645" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2018" y="1660" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.14 返回这段新号区间的最大值</text><line x1="2386" y1="1691" x2="1649" y2="1691" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="2015" y="1706" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.15 将这一批连续 nonce 依次写入預取池\n并设置过期时间</text><line x1="1646" y1="1737" x2="2383" y2="1737" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="1752" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.16 从新的預取池中取出本次要用的第一个 nonce</text><line x1="1646" y1="1783" x2="2383" y2="1783" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="1814" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.17 为本次分配写入快照记录为預留状态</text><line x1="1646" y1="1845" x2="2383" y2="1845" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="1860" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.18 写入一条預留事件到刷盘队列\n用于后续异步落库</text><line x1="1646" y1="1891" x2="2383" y2="1891" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1356" y="1906" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">5P.19 返回用户和本次分配的 nonce</text><line x1="1644" y1="1937" x2="1068" y2="1937" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="897" y="1968" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">13 返回 nonce 分配结果</text><line x1="1063" y1="1999" x2="731" y2="1999" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="412" y="2014" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">14 把 nonce 和上下文交给业务系统</text><line x1="726" y1="2045" x2="98" y2="2045" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="95" y="2060" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">15 使用 nonce 执行业务操作</text><path d="M 95,2091 C 155,2081 155,2121 95,2111" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="409" y="2136" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">16 返回业务结果\n(成功 / 失败 / 计划重试)</text><line x1="95" y1="2167" x2="723" y2="2167" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="894" y="2182" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">17 请求根据业务结果更新 nonce 状态</text><line x1="728" y1="2213" x2="1060" y2="2213" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1202" y="2285" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">18R 更新状态交给可靠引擎</text><line x1="1065" y1="2316" x2="1338" y2="2316" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2335" y="2331" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">19R 在数据库事务中按业务结果更新状态\n成功标记已使用\n失败且不再重试标记可回收\n计划重试保持預留</text><line x1="1343" y1="2362" x2="3326.5" y2="2362" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2338" y="2377" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">20R 状态更新完成</text><line x1="3329.5" y1="2408" x2="1346" y2="2408" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1205" y="2423" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">21R 返回更新结果</text><line x1="1341" y1="2454" x2="1068" y2="2454" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1353" y="2542" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">18P 更新状态交给性能引擎</text><line x1="1065" y1="2573" x2="1641" y2="2573" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1854" y="2588" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">19P 为该用户短暂加锁, 确保同一 nonce 串行更新</text><line x1="1646" y1="2619" x2="2061" y2="2619" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2225" y="2634" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">20P 在 Redis 中加锁</text><line x1="2066" y1="2665" x2="2383" y2="2665" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2228" y="2680" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">21P 锁成功</text><line x1="2386" y1="2711" x2="2069" y2="2711" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1857" y="2726" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">22P 可以安全更新缓存</text><line x1="2064" y1="2757" x2="1649" y2="2757" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="2015" y="2772" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">23P.1 读取该 nonce 的快照</text><line x1="1646" y1="2803" x2="2383" y2="2803" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="2859" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">23P.2 将快照标记为已使用, 记录交易信息</text><line x1="1646" y1="2890" x2="2383" y2="2890" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="2905" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">23P.3 从可复用池中移除该 nonce</text><line x1="1646" y1="2936" x2="2383" y2="2936" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="2951" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">23P.4 写入一条已使用事件到刷盘队列</text><line x1="1646" y1="2982" x2="2383" y2="2982" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="3038" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">23P.5 将快照标记为可回收</text><line x1="1646" y1="3069" x2="2383" y2="3069" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="3084" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">23P.6 将该 nonce 放入可复用池</text><line x1="1646" y1="3115" x2="2383" y2="3115" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="3130" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">23P.7 写入一条可回收事件到刷盘队列</text><line x1="1646" y1="3161" x2="2383" y2="3161" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2015" y="3217" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">23P.8 保持快照为預留状态, 必要时仅更新备注</text><line x1="1646" y1="3248" x2="2383" y2="3248" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1356" y="3271" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">24P 返回更新结果</text><line x1="1644" y1="3302" x2="1068" y2="3302" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="897" y="3333" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">25 通知模板本次 nonce 生命周期结束</text><line x1="1063" y1="3364" x2="731" y2="3364" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="568" y="3379" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">26 汇总业务结果和 nonce 使用情况</text><line x1="726" y1="3410" x2="410" y2="3410" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="252" y="3425" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">27 返回统一响应</text><line x1="405" y1="3456" x2="98" y2="3456" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="2555" y="3528" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">28 从刷盘队列批量取出待处理事件</text><line x1="2719.5" y1="3559" x2="2391" y2="3559" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2552" y="3574" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">29 返回一批事件</text><line x1="2388" y1="3605" x2="2716.5" y2="3605" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="3024" y="3661" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">30 在一个数据库事务中依次应用事件\n创建預留记录 标记已使用 标记可回收</text><line x1="2721.5" y1="3692" x2="3326.5" y2="3692" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="3027" y="3748" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">31 落库成功</text><line x1="3329.5" y1="3779" x2="2724.5" y2="3779" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="2555" y="3794" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">32 删除这些事件</text><line x1="2719.5" y1="3825" x2="2391" y2="3825" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2184" y="3840" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">33 通知性能引擎本批次成功\n可清理已终结快照并更新健康状态</text><line x1="2719.5" y1="3871" x2="1649" y2="3871" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="3027" y="3927" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">31e 事务回滚</text><line x1="3329.5" y1="3958" x2="2724.5" y2="3958" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="2555" y="3973" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">32e 将事件退回队列等待重试</text><line x1="2719.5" y1="4004" x2="2391" y2="4004" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2184" y="4019" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">33e 通知性能引擎本批次失败\n记录异常并更新健康指标</text><line x1="2719.5" y1="4050" x2="1649" y2="4050" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2722" y="4114" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">30b 本轮无任务</text><path d="M 2721.5,4145 C 2781.5,4135 2781.5,4175 2721.5,4165" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></path><text x="2314" y="4260" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">34 查询当前模式或发起切换</text><line x1="3559" y1="4291" x2="1068" y2="4291" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2311" y="4306" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">35 返回当前模式信息\n可靠 性能 双写 排空 降级</text><line x1="1065" y1="4337" x2="3556" y2="4337" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="2314" y="4352" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">36 例如请求从可靠升级到性能 或 从性能回退到可靠</text><line x1="3559" y1="4383" x2="1068" y2="4383" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1353" y="4398" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">37 切到性能前询问条件是否满足\n队列是否已清空 Redis 是否健康</text><line x1="1065" y1="4429" x2="1641" y2="4429" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1356" y="4444" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">38 返回检查结果</text><line x1="1644" y1="4475" x2="1068" y2="4475" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1065" y="4490" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">39 条件满足时更新内部模式状态\n记录切换时间和日志</text><path d="M 1065,4521 C 1125,4511 1125,4551 1065,4541" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="2715" y="4566" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">40 提供性能链路健康数据\nRedis状况 队列长度 最近成功失败时间 預取池耗尽情况</text><line x1="1646" y1="4597" x2="3783" y2="4597" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="2424" y="4612" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">41 提供当前模式和最近一次模式切换信息</text><line x1="1065" y1="4643" x2="3783" y2="4643" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="2427" y="4658" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: sans-serif; font-size: 16px; font-weight: 400;">42 运维根据看板决定是否调整模式和預取策略</text><line x1="3786" y1="4689" x2="1068" y2="4689" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></svg></div><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p></div></div>
</body>
</html>